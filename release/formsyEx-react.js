!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("react"),require("underscore")):"function"==typeof define&&define.amd?define(["react","underscore"],r):"object"==typeof exports?exports.FormsyEx=r(require("react"),require("underscore")):t.FormsyEx=r(t.react,t.underscore)}(this,function(t,r){return function(t){function r(n){if(e[n])return e[n].exports;var s=e[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r,e){(function(r){"use strict";var n=(r.React||e(1),{}),s=e(6),o=e(5),i=e(2);n.Mixin=i,n.Form=s,n.Block=o,r.exports||r.module||r.define&&r.define.amd||(r.FormsyEx=n),t.exports=n}).call(r,function(){return this}())},function(r,e){r.exports=t},function(t,r,e){(function(r){"use strict";var n=r.React||e(1),s=e(4),o={},i=e(3),u="_DEFAULT_FORM";t.exports={focus:function(){n.findDOMNode(this.refs.focus)&&n.findDOMNode(this.refs.focus).focus()},getInitialState:function(){return{_formsyExValue:"",_formsyExErrorMsgs:[]}},componentWillMount:function(){var t=this;if(t.isInit===!0)return void 0;if(t.isForm){var r=t.props.name?t.props.name:u;o[r]&&(t.inputs=o[r].inputs,t.childId=o[r].childId),o[r]=t,n.Children.forEach(t.children,function(e){return void 0!==e.props.regForm&&e.props.regForm!==r?void 0:(t.register(e),void(e.isInit=!0))})}else{var e;e=t.props.regForm?t.props.regForm:u,void 0===o[e]&&(o[e]=i()),o[e].register(t)}t.isInit=!0},componentWillUnmount:function(){var t=this;if(!t.isInit)return void 0;if(t.isForm){var r=t.props.name?t.props.name:u;delete o[r],t.isInit=!1}else{var e=t.props.regForm?t.props.regForm:u;o[e]?o[e].unregister(t):void 0}},validate:function(t){var r,e,n=void 0!==t?t:this.state._formValue,o=this.getValidators(),i=!0;return o&&(r=s.map(o,function(t){return i===!1?"":(e=t(n)||{},e["continue"]===!1&&(i=!1),e.res===!1?e.msg:"")})),r=s.filter(r,function(t){return!0&&t}),this.setState({_formValue:n,_formsyExErrorMsgs:r}),0===r.length},getValue:function(){return this.state._formValue},getErrorMsg:function(){return 1===this.state._formsyExErrorMsgs.length?this.state._formsyExErrorMsgs[0]:this.state._formsyExErrorMsgs},getValidators:function(){var t=this.validators&&this.validators.call?[this.validators]:this.validators||[],r=t.concat(this.props.validators||[]);return r}}}).call(r,function(){return this}())},function(t,r,e){(function(r){"use strict";var n=r.React||e(1),s=e(4);t.exports=function(){return{isForm:!0,register:function(t){this.inputs=this.inputs||{},this.childId=this.childId||0,t.regId=t.props.name||this.childId++,this.inputs[t.regId]=t},unregister:function(t){delete this.inputs[t.regId]},submit:function(t){t.stopPropagation()||t.preventDefault();var r=void 0;s.each(this.inputs,function(t){var e=t.validate();r=void 0===r&&e===!1?t:r}),void 0===r?this.props.onSubmit.apply(this,arguments):r.focus&&r.focus()},render:function(){return n.createElement("form",{onSubmit:this.submit,style:this.props.style,className:this.props.className},this.props.children)}}}}).call(r,function(){return this}())},function(t,e){t.exports=r},function(t,r,e){(function(r){"use strict";var n=r.React||e(1);t.exports=n.createClass({displayName:"module.exports",mixins:[e(2)],render:function(){var t=this.getErrorMsg();return n.createElement("div",{style:this.props.style},this.props.children,n.createElement("label",{style:{color:"red"}},t,n.createElement("input",{ref:"focus",style:{opacity:"0"}})))}})}).call(r,function(){return this}())},function(t,r,e){(function(r){"use strict";var n=r.React||e(1),s=e(7);t.exports=n.createClass(s({mixins:[e(2)]},e(3)()))}).call(r,function(){return this}())},function(t,r){"use strict";function e(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function n(t){var r=Object.getOwnPropertyNames(t);return Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t))),r.filter(function(r){return s.call(t,r)})}var s=Object.prototype.propertyIsEnumerable;t.exports=Object.assign||function(t,r){for(var s,o,i=e(t),u=1;u<arguments.length;u++){s=arguments[u],o=n(Object(s));for(var c=0;c<o.length;c++)i[o[c]]=s[o[c]]}return i}}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy9mb3Jtc3lFeC1yZWFjdC5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgZjlmNjAxMmEyYjVhYzc1ZDY1Y2EiLCJ3ZWJwYWNrOi8vLy4vbGliL21haW4uanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwicmVhY3RcIiIsIndlYnBhY2s6Ly8vLi9saWIvTWl4aW4uanMiLCJ3ZWJwYWNrOi8vLy4vbGliL2Zvcm0uanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwidW5kZXJzY29yZVwiIiwid2VicGFjazovLy8uL2xpYi9CbG9jay5qc3giLCJ3ZWJwYWNrOi8vLy4vbGliL0Zvcm0uanN4Iiwid2VicGFjazovLy8uL34vb2JqZWN0LWFzc2lnbi9pbmRleC5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJyZXF1aXJlIiwiZGVmaW5lIiwiYW1kIiwidGhpcyIsIl9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfMV9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV80X18iLCJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImlkIiwibG9hZGVkIiwiY2FsbCIsIm0iLCJjIiwicCIsImdsb2JhbCIsIkZvcm1zeUV4IiwiUmVhY3QiLCJGb3JtIiwiQmxvY2siLCJNaXhpbiIsIl8iLCJyZWdGb3JtcyIsIm1vY2tGb3JtIiwiZGVmYXVsdEZvcm0iLCJmb2N1cyIsImZpbmRET01Ob2RlIiwicmVmcyIsImdldEluaXRpYWxTdGF0ZSIsIl9mb3Jtc3lFeFZhbHVlIiwiX2Zvcm1zeUV4RXJyb3JNc2dzIiwiY29tcG9uZW50V2lsbE1vdW50IiwiY29tcG9uZW50IiwiaXNJbml0IiwidW5kZWZpbmVkIiwiaXNGb3JtIiwiZm9ybU5hbWUiLCJwcm9wcyIsIm5hbWUiLCJpbnB1dHMiLCJjaGlsZElkIiwiQ2hpbGRyZW4iLCJmb3JFYWNoIiwiY2hpbGRyZW4iLCJjaGlsZCIsInJlZ0Zvcm0iLCJyZWdpc3RlciIsInJlZ1RvRm9ybU5hbWUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInVucmVnaXN0ZXIiLCJ2YWxpZGF0ZSIsInZhbHVlIiwiZm9ybXN5RXhFcnJvck1zZ3MiLCJyZXMiLCJfdmFsdWUiLCJzdGF0ZSIsIl9mb3JtVmFsdWUiLCJ2YWxpZGF0b3JzIiwiZ2V0VmFsaWRhdG9ycyIsImlzQ29udGludWUiLCJtYXAiLCJ2YWxpZGF0b3IiLCJtc2ciLCJmaWx0ZXIiLCJmb3Jtc3lFeEVycm9yTXNnIiwic2V0U3RhdGUiLCJsZW5ndGgiLCJnZXRWYWx1ZSIsImdldEVycm9yTXNnIiwicHJvcGVydHlWYWxpZGF0b3IiLCJjb25jYXQiLCJyZWdJZCIsInN1Ym1pdCIsImV2ZW50Iiwic3RvcFByb3BhZ2F0aW9uIiwicHJldmVudERlZmF1bHQiLCJmaXJzdEVycm9yQ29tcG9uZW50IiwiZWFjaCIsIm9uU3VibWl0IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJyZW5kZXIiLCJjcmVhdGVFbGVtZW50Iiwic3R5bGUiLCJjbGFzc05hbWUiLCJjcmVhdGVDbGFzcyIsImRpc3BsYXlOYW1lIiwibWl4aW5zIiwiZXJyb3JNc2ciLCJjb2xvciIsInJlZiIsIm9wYWNpdHkiLCJvYmplY3RBc3NpZ24iLCJUb09iamVjdCIsInZhbCIsIlR5cGVFcnJvciIsIk9iamVjdCIsIm93bkVudW1lcmFibGVLZXlzIiwib2JqIiwia2V5cyIsImdldE93blByb3BlcnR5TmFtZXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJrZXkiLCJwcm9wSXNFbnVtZXJhYmxlIiwicHJvdG90eXBlIiwicHJvcGVydHlJc0VudW1lcmFibGUiLCJhc3NpZ24iLCJ0YXJnZXQiLCJzb3VyY2UiLCJmcm9tIiwidG8iLCJzIiwiaSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxnQkFBQUMsVUFBQSxnQkFBQUMsUUFDQUEsT0FBQUQsUUFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLGVBQ0Esa0JBQUFDLGdCQUFBQyxJQUNBRCxRQUFBLHNCQUFBSixHQUNBLGdCQUFBQyxTQUNBQSxRQUFBLFNBQUFELEVBQUFHLFFBQUEsU0FBQUEsUUFBQSxlQUVBSixFQUFBLFNBQUFDLEVBQUFELEVBQUEsTUFBQUEsRUFBQSxhQUNDTyxLQUFBLFNBQUFDLEVBQUFDLEdBQ0QsTUNBZ0IsVUFBVUMsR0NOMUIsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE1BQUFDLEdBQUFELEdBQUFWLE9BR0EsSUFBQUMsR0FBQVUsRUFBQUQsSUFDQVYsV0FDQVksR0FBQUYsRUFDQUcsUUFBQSxFQVVBLE9BTkFMLEdBQUFFLEdBQUFJLEtBQUFiLEVBQUFELFFBQUFDLElBQUFELFFBQUFTLEdBR0FSLEVBQUFZLFFBQUEsRUFHQVosRUFBQUQsUUF2QkEsR0FBQVcsS0FxQ0EsT0FUQUYsR0FBQU0sRUFBQVAsRUFHQUMsRUFBQU8sRUFBQUwsRUFHQUYsRUFBQVEsRUFBQSxHQUdBUixFQUFBLEtEZ0JNLFNBQVNSLEVBQVFELEVBQVNTLElBRUgsU0FBU1MsR0FBUyxZRXhEL0MsSUFDSUMsSUFEUUQsRUFBT0UsT0FBU1gsRUFBUSxPQUVoQ1ksRUFBT1osRUFBUSxHQUNmYSxFQUFRYixFQUFRLEdBQ2hCYyxFQUFRZCxFQUFRLEVBRXBCVSxHQUFTSSxNQUFRQSxFQUNqQkosRUFBU0UsS0FBT0EsRUFDaEJGLEVBQVNHLE1BQVFBLEVBRVpKLEVBQU9sQixTQUFZa0IsRUFBT2pCLFFBQVlpQixFQUFPZixRQUFXZSxFQUFPZixPQUFPQyxNQUN6RWMsRUFBT0MsU0FBV0EsR0FHcEJsQixFQUFPRCxRQUFVbUIsSUYyRGFMLEtBQUtkLEVBQVUsV0FBYSxNQUFPSyxXQUkzRCxTQUFTSixFQUFRRCxHRzdFdkJDLEVBQUFELFFBQUFNLEdIbUZNLFNBQVNMLEVBQVFELEVBQVNTLElBRUgsU0FBU1MsR0FBUyxZSXJGL0MsSUFBSUUsR0FBUUYsRUFBT0UsT0FBU1gsRUFBUSxHQUNoQ2UsRUFBSWYsRUFBUSxHQUNaZ0IsS0FDQUMsRUFBV2pCLEVBQVEsR0FDbkJrQixFQUFjLGVBRWxCMUIsR0FBT0QsU0FDSDRCLE1BQU8sV0FJSFIsRUFBTVMsWUFBWXhCLEtBQUt5QixLQUFLRixRQUN4QlIsRUFBTVMsWUFBWXhCLEtBQUt5QixLQUFLRixPQUFPQSxTQUUzQ0csZ0JBQWlCLFdBQ2IsT0FDSUMsZUFBZ0IsR0FDaEJDLHdCQUdSQyxtQkFBb0IsV0FDaEIsR0FBSUMsR0FBWTlCLElBQ2hCLElBQUk4QixFQUFVQyxVQUFXLEVBQ3JCLE1BQU9DLE9BRVgsSUFBSUYsRUFBVUcsT0FBUSxDQUVsQixHQUFJQyxHQUFXSixFQUFVSyxNQUFNQyxLQUFPTixFQUFVSyxNQUFNQyxLQUFPZCxDQUN6REYsR0FBU2MsS0FDVEosRUFBVU8sT0FBU2pCLEVBQVNjLEdBQVVHLE9BQ3RDUCxFQUFVUSxRQUFVbEIsRUFBU2MsR0FBVUksU0FFM0NsQixFQUFTYyxHQUFZSixFQUNyQmYsRUFBTXdCLFNBQVNDLFFBQ1hWLEVBQVVXLFNBQ1YsU0FBVUMsR0FDTixNQUM0QlYsVUFBeEJVLEVBQU1QLE1BQU1RLFNBQ1pELEVBQU1QLE1BQU1RLFVBQVlULEVBR2pCRixRQUVYRixFQUFVYyxTQUFTRixRQUNuQkEsRUFBTVgsUUFBUyxVQUl0QixDQUNELEdBQUljLEVBSUpBLEdBQWdCZixFQUFVSyxNQUFNUSxRQUFVYixFQUFVSyxNQUFNUSxRQUFVckIsRUFDcENVLFNBQTVCWixFQUFTeUIsS0FDVHpCLEVBQVN5QixHQUFpQnhCLEtBRTlCRCxFQUFTeUIsR0FBZUQsU0FBU2QsR0FFckNBLEVBQVVDLFFBQVMsR0FFdkJlLHFCQUFzQixXQUNsQixHQUFJaEIsR0FBWTlCLElBQ2hCLEtBQUs4QixFQUFVQyxPQUNYLE1BQU9DLE9BRVgsSUFBSUYsRUFBVUcsT0FBUSxDQUVsQixHQUFJQyxHQUFXSixFQUFVSyxNQUFNQyxLQUFPTixFQUFVSyxNQUFNQyxLQUFPZCxRQUN0REYsR0FBU2MsR0FDaEJKLEVBQVVDLFFBQVMsTUFFbEIsQ0FDRCxHQUFJYyxHQUFnQmYsRUFBVUssTUFBTVEsUUFBVWIsRUFBVUssTUFBTVEsUUFBVXJCLENBQ3hFRixHQUFTeUIsR0FBa0J6QixFQUFTeUIsR0FBZUUsV0FBV2pCLEdBQWNFLFNBR3BGZ0IsU0FBVSxTQUFVQyxHQUNoQixHQUVJQyxHQUVBQyxFQUpBQyxFQUFtQnBCLFNBQVZpQixFQUFzQkEsRUFBUWpELEtBQUtxRCxNQUFNQyxXQUNsREMsRUFBYXZELEtBQUt3RCxnQkFFbEJDLEdBQWEsQ0E4QmpCLE9BNUJBRixLQUNLTCxFQUFvQi9CLEVBQUV1QyxJQUFJSCxFQUN2QixTQUFVSSxHQUNOLE1BQUlGLE1BQWUsRUFDUixJQUVYTixFQUFNUSxFQUFVUCxPQUNaRCxFQUFHLGVBQWMsSUFDakJNLEdBQWEsR0FFYk4sRUFBSUEsT0FBUSxFQUNMQSxFQUFJUyxJQUVSLE9BR25CVixFQUFvQi9CLEVBQUUwQyxPQUNsQlgsRUFDQSxTQUFVWSxHQUNOLE9BQU8sR0FBUUEsSUFHdkI5RCxLQUFLK0QsVUFFR1QsV0FBWUYsRUFDWnhCLG1CQUFvQnNCLElBR1EsSUFBN0JBLEVBQWtCYyxRQUU3QkMsU0FBVSxXQUNOLE1BQU9qRSxNQUFLcUQsTUFBTUMsWUFFdEJZLFlBQWEsV0FDVCxNQUFnRCxLQUF6Q2xFLEtBQUtxRCxNQUFNekIsbUJBQW1Cb0MsT0FDN0JoRSxLQUFLcUQsTUFBTXpCLG1CQUFtQixHQUFLNUIsS0FBS3FELE1BQU16QixvQkFFMUQ0QixjQUFlLFdBQ1gsR0FBSVcsR0FBcUJuRSxLQUFLdUQsWUFBY3ZELEtBQUt1RCxXQUFXOUMsTUFDdkRULEtBQUt1RCxZQUNMdkQsS0FBS3VELGVBQ05BLEVBQWFZLEVBQWtCQyxPQUFPcEUsS0FBS21DLE1BQU1vQixlQUNyRCxPQUFPQSxPSjBFZTlDLEtBQUtkLEVBQVUsV0FBYSxNQUFPSyxXQUkzRCxTQUFTSixFQUFRRCxFQUFTUyxJQUVILFNBQVNTLEdBQVMsWUs3TS9DLElBQUlFLEdBQVFGLEVBQU9FLE9BQVNYLEVBQVEsR0FDaENlLEVBQUlmLEVBQVEsRUFDaEJSLEdBQU9ELFFBQVUsV0FDYixPQUNJc0MsUUFBUSxFQUNSVyxTQUFVLFNBQVVGLEdBQ2hCMUMsS0FBS3FDLE9BQVNyQyxLQUFLcUMsV0FDbkJyQyxLQUFLc0MsUUFBVXRDLEtBQUtzQyxTQUFXLEVBQy9CSSxFQUFNMkIsTUFBUTNCLEVBQU1QLE1BQU1DLE1BQVFwQyxLQUFLc0MsVUFDdkN0QyxLQUFLcUMsT0FBT0ssRUFBTTJCLE9BQVMzQixHQUUvQkssV0FBWSxTQUFVTCxTQUNYMUMsTUFBS3FDLE9BQU9LLEVBQU0yQixRQUU3QkMsT0FBUSxTQUFVQyxHQUNkQSxFQUFNQyxtQkFBcUJELEVBQU1FLGdCQUNqQyxJQUFJQyxHQUFzQjFDLE1BQzFCYixHQUFFd0QsS0FDRTNFLEtBQUtxQyxPQUNELFNBQVVQLEdBQ04sR0FBSXFCLEdBQU1yQixFQUFVa0IsVUFDcEIwQixHQUErQzFDLFNBQXpCMEMsR0FBc0N2QixLQUFRLEVBQVNyQixFQUFXNEMsSUFHNUUxQyxTQUF4QjBDLEVBQ0kxRSxLQUFLbUMsTUFBTXlDLFNBQVNDLE1BQU03RSxLQUFNOEUsV0FDaENKLEVBQW9CbkQsT0FBU21ELEVBQW9CbkQsU0FFekR3RCxPQUFRLFdBQ0osTUFDSWhFLEdBQUFpRSxjTDBNQyxRSzFNS0osU0FBVTVFLEtBQUtzRSxPQUFRVyxNQUFPakYsS0FBS21DLE1BQU04QyxNQUFPQyxVQUFXbEYsS0FBS21DLE1BQU0rQyxXQUN2RWxGLEtBQUttQyxNQUFNTSxlTGdORmhDLEtBQUtkLEVBQVUsV0FBYSxNQUFPSyxXQUkzRCxTQUFTSixFQUFRRCxHTW5QdkJDLEVBQUFELFFBQUFPLEdOeVBNLFNBQVNOLEVBQVFELEVBQVNTLElPelBoQyxTQUFBUyxHQUFBLFlBQ0EsSUFBSUUsR0FBUUYsRUFBT0UsT0FBU1gsRUFBUSxFQUVwQ1IsR0FBQUQsUUFBQW9CLEVBQUFvRSxhQUFvQ0MsWUFBQSxpQkFDaENDLFFBQ0dqRixFQUFRLElBRVgyRSxPQUFRLFdBQ0osR0FBSU8sR0FBV3RGLEtBQUtrRSxhQUNwQixPQUNJbkQsR0FBQWlFLGNBQUEsT0FBSUMsTUFBQ2pGLEtBQU9tQyxNQUFLOEMsT0FDWmpGLEtBQUttQyxNQUFNTSxTQUNaMUIsRUFBQWlFLGNBQUEsU0FBTUMsT0FBTU0sTUFBUSxRQUFVRCxFQUFVdkUsRUFBQWlFLGNBQUEsU0FBTVEsSUFBQyxRQUFJUCxPQUFRUSxRQUFRLGNQeVByRGhGLEtBQUtkLEVBQVUsV0FBYSxNQUFPSyxXQUkzRCxTQUFTSixFQUFRRCxFQUFTUyxJUXpRaEMsU0FBQVMsR0FBQSxZQUNBLElBQUlFLEdBQVFGLEVBQU9FLE9BQVNYLEVBQVEsR0FDaENzRixFQUFldEYsRUFBUSxFQUMzQlIsR0FBT0QsUUFBVW9CLEVBQU1vRSxZQUFZTyxHQUFjTCxRQUFTakYsRUFBUSxLQUFjQSxFQUFRLFNSNFExREssS0FBS2QsRUFBVSxXQUFhLE1BQU9LLFdBSTNELFNBQVNKLEVBQVFELEdTblJ2QixZQUdBLFNBQUFnRyxHQUFBQyxHQUNBLFNBQUFBLEVBQ0EsU0FBQUMsV0FBQSx3REFHQSxPQUFBQyxRQUFBRixHQUdBLFFBQUFHLEdBQUFDLEdBQ0EsR0FBQUMsR0FBQUgsT0FBQUksb0JBQUFGLEVBTUEsT0FKQUYsUUFBQUssd0JBQ0FGLElBQUE3QixPQUFBMEIsT0FBQUssc0JBQUFILEtBR0FDLEVBQUFwQyxPQUFBLFNBQUF1QyxHQUNBLE1BQUFDLEdBQUE1RixLQUFBdUYsRUFBQUksS0FsQkEsR0FBQUMsR0FBQVAsT0FBQVEsVUFBQUMsb0JBc0JBM0csR0FBQUQsUUFBQW1HLE9BQUFVLFFBQUEsU0FBQUMsRUFBQUMsR0FLQSxPQUpBQyxHQUNBVixFQUNBVyxFQUFBakIsRUFBQWMsR0FFQUksRUFBQSxFQUFnQkEsRUFBQS9CLFVBQUFkLE9BQXNCNkMsSUFBQSxDQUN0Q0YsRUFBQTdCLFVBQUErQixHQUNBWixFQUFBRixFQUFBRCxPQUFBYSxHQUVBLFFBQUFHLEdBQUEsRUFBaUJBLEVBQUFiLEVBQUFqQyxPQUFpQjhDLElBQ2xDRixFQUFBWCxFQUFBYSxJQUFBSCxFQUFBVixFQUFBYSxJQUlBLE1BQUFGIiwiZmlsZSI6ImZvcm1zeUV4LXJlYWN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwicmVhY3RcIiksIHJlcXVpcmUoXCJ1bmRlcnNjb3JlXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtcInJlYWN0XCIsIFwidW5kZXJzY29yZVwiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJGb3Jtc3lFeFwiXSA9IGZhY3RvcnkocmVxdWlyZShcInJlYWN0XCIpLCByZXF1aXJlKFwidW5kZXJzY29yZVwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiRm9ybXN5RXhcIl0gPSBmYWN0b3J5KHJvb3RbXCJyZWFjdFwiXSwgcm9vdFtcInVuZGVyc2NvcmVcIl0pO1xufSkodGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNF9fKSB7XG5yZXR1cm4gXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uXG4gKiovIiwiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwicmVhY3RcIiksIHJlcXVpcmUoXCJ1bmRlcnNjb3JlXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtcInJlYWN0XCIsIFwidW5kZXJzY29yZVwiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJGb3Jtc3lFeFwiXSA9IGZhY3RvcnkocmVxdWlyZShcInJlYWN0XCIpLCByZXF1aXJlKFwidW5kZXJzY29yZVwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiRm9ybXN5RXhcIl0gPSBmYWN0b3J5KHJvb3RbXCJyZWFjdFwiXSwgcm9vdFtcInVuZGVyc2NvcmVcIl0pO1xufSkodGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNF9fKSB7XG5yZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcFxuLyoqKioqKi8gXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge30sXG4vKioqKioqLyBcdFx0XHRpZDogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG4vKioqKioqLyB9KVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKioqKiovIChbXG4vKiAwICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnO1xuXHRcblx0dmFyIFJlYWN0ID0gZ2xvYmFsLlJlYWN0IHx8IF9fd2VicGFja19yZXF1aXJlX18oMSksXG5cdCAgICBGb3Jtc3lFeCA9IHt9LFxuXHQgICAgRm9ybSA9IF9fd2VicGFja19yZXF1aXJlX18oNiksXG5cdCAgICBCbG9jayA9IF9fd2VicGFja19yZXF1aXJlX18oNSksXG5cdCAgICBNaXhpbiA9IF9fd2VicGFja19yZXF1aXJlX18oMik7XG5cdFxuXHRGb3Jtc3lFeC5NaXhpbiA9IE1peGluO1xuXHRGb3Jtc3lFeC5Gb3JtID0gRm9ybTtcblx0Rm9ybXN5RXguQmxvY2sgPSBCbG9jaztcblx0XG5cdGlmICghZ2xvYmFsLmV4cG9ydHMgJiYgIWdsb2JhbC5tb2R1bGUgJiYgKCFnbG9iYWwuZGVmaW5lIHx8ICFnbG9iYWwuZGVmaW5lLmFtZCkpIHtcblx0ICAgIGdsb2JhbC5Gb3Jtc3lFeCA9IEZvcm1zeUV4O1xuXHR9XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IEZvcm1zeUV4O1xuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoZXhwb3J0cywgKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSgpKSkpXG5cbi8qKiovIH0sXG4vKiAxICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfMV9fO1xuXG4vKioqLyB9LFxuLyogMiAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0LyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0Jztcblx0XG5cdHZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpLFxuXHQgICAgXyA9IF9fd2VicGFja19yZXF1aXJlX18oNCksXG5cdCAgICByZWdGb3JtcyA9IHt9LFxuXHQgICAgbW9ja0Zvcm0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpLFxuXHQgICAgZGVmYXVsdEZvcm0gPSAnX0RFRkFVTFRfRk9STSc7XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IHtcblx0ICAgIGZvY3VzOiBmdW5jdGlvbiBmb2N1cygpIHtcblx0ICAgICAgICAvLyBpZiAoIXRoaXMucmVmcy5mb2N1cykge1xuXHQgICAgICAgIC8vICAgIHRocm93IG5ldyBFcnJvcignc2hvdWxkIGhhdmUgYSBjaGlsZCBjb21wb25lbnQgd2l0aCByZWYgbmFtZSBgaW5wdXRgLCBtb3N0IG9mIHRoZSBjYXNlIHJlZiBpcyBzZXQgb24gRXJyb3JNc2dMYWJlbCcpO1xuXHQgICAgICAgIC8vIH1cblx0ICAgICAgICBSZWFjdC5maW5kRE9NTm9kZSh0aGlzLnJlZnMuZm9jdXMpICYmIFJlYWN0LmZpbmRET01Ob2RlKHRoaXMucmVmcy5mb2N1cykuZm9jdXMoKTtcblx0ICAgIH0sXG5cdCAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcblx0ICAgICAgICByZXR1cm4ge1xuXHQgICAgICAgICAgICBfZm9ybXN5RXhWYWx1ZTogJycsXG5cdCAgICAgICAgICAgIF9mb3Jtc3lFeEVycm9yTXNnczogW11cblx0ICAgICAgICB9O1xuXHQgICAgfSxcblx0ICAgIGNvbXBvbmVudFdpbGxNb3VudDogZnVuY3Rpb24gY29tcG9uZW50V2lsbE1vdW50KCkge1xuXHQgICAgICAgIHZhciBjb21wb25lbnQgPSB0aGlzO1xuXHQgICAgICAgIGlmIChjb21wb25lbnQuaXNJbml0ID09PSB0cnVlKSB7XG5cdCAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGlmIChjb21wb25lbnQuaXNGb3JtKSB7XG5cdCAgICAgICAgICAgIC8vIGZvcm1cblx0ICAgICAgICAgICAgLy8gZm9ybSBvYmplY3Rcblx0ICAgICAgICAgICAgdmFyIGZvcm1OYW1lID0gY29tcG9uZW50LnByb3BzLm5hbWUgPyBjb21wb25lbnQucHJvcHMubmFtZSA6IGRlZmF1bHRGb3JtO1xuXHQgICAgICAgICAgICBpZiAocmVnRm9ybXNbZm9ybU5hbWVdKSB7XG5cdCAgICAgICAgICAgICAgICBjb21wb25lbnQuaW5wdXRzID0gcmVnRm9ybXNbZm9ybU5hbWVdLmlucHV0cztcblx0ICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jaGlsZElkID0gcmVnRm9ybXNbZm9ybU5hbWVdLmNoaWxkSWQ7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgcmVnRm9ybXNbZm9ybU5hbWVdID0gY29tcG9uZW50O1xuXHQgICAgICAgICAgICBSZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNvbXBvbmVudC5jaGlsZHJlbiwgZnVuY3Rpb24gKGNoaWxkKSB7XG5cdCAgICAgICAgICAgICAgICBpZiAoY2hpbGQucHJvcHMucmVnRm9ybSAhPT0gdW5kZWZpbmVkICYmIGNoaWxkLnByb3BzLnJlZ0Zvcm0gIT09IGZvcm1OYW1lKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgLy8gY29tcG9uZW50cyBhcmUgcmVnaXN0ZXJlZCB0byBhbm90aGVyIGZvcm1cblx0ICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXHQgICAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICAgICAgY29tcG9uZW50LnJlZ2lzdGVyKGNoaWxkKTtcblx0ICAgICAgICAgICAgICAgIGNoaWxkLmlzSW5pdCA9IHRydWU7XG5cdCAgICAgICAgICAgIH0pO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgIC8vIGVsZW1lbnRzIGluIGZvcm1cblx0ICAgICAgICAgICAgdmFyIHJlZ1RvRm9ybU5hbWU7XG5cdCAgICAgICAgICAgIC8vIGlmICghdGhpcy52YWxpZGF0b3IgfHwgIXRoaXMudmFsaWRhdG9yLmNhbGwpIHtcblx0ICAgICAgICAgICAgLy8gICAgdGhyb3cgbmV3IEVycm9yKCdzaG91bGQgaW1wbGVtZW50IGBmb2N1c2AgYW5kIGB2YWxpZGF0b3JgIGZ1bmN0aW9uJyk7XG5cdCAgICAgICAgICAgIC8vIH1cblx0ICAgICAgICAgICAgcmVnVG9Gb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtID8gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gOiBkZWZhdWx0Rm9ybTtcblx0ICAgICAgICAgICAgaWYgKHJlZ0Zvcm1zW3JlZ1RvRm9ybU5hbWVdID09PSB1bmRlZmluZWQpIHtcblx0ICAgICAgICAgICAgICAgIHJlZ0Zvcm1zW3JlZ1RvRm9ybU5hbWVdID0gbW9ja0Zvcm0oKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICByZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXS5yZWdpc3Rlcihjb21wb25lbnQpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gdHJ1ZTtcblx0ICAgIH0sXG5cdCAgICBjb21wb25lbnRXaWxsVW5tb3VudDogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG5cdCAgICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXM7XG5cdCAgICAgICAgaWYgKCFjb21wb25lbnQuaXNJbml0KSB7XG5cdCAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGlmIChjb21wb25lbnQuaXNGb3JtKSB7XG5cdCAgICAgICAgICAgIC8vIGZvcm1cblx0ICAgICAgICAgICAgLy8gZm9ybSBvYmplY3Rcblx0ICAgICAgICAgICAgdmFyIGZvcm1OYW1lID0gY29tcG9uZW50LnByb3BzLm5hbWUgPyBjb21wb25lbnQucHJvcHMubmFtZSA6IGRlZmF1bHRGb3JtO1xuXHQgICAgICAgICAgICBkZWxldGUgcmVnRm9ybXNbZm9ybU5hbWVdO1xuXHQgICAgICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gZmFsc2U7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgLy8gZWxlbWVudHMgaW4gZm9ybVxuXHQgICAgICAgICAgICB2YXIgcmVnVG9Gb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtID8gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gOiBkZWZhdWx0Rm9ybTtcblx0ICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0gPyByZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXS51bnJlZ2lzdGVyKGNvbXBvbmVudCkgOiB1bmRlZmluZWQ7XG5cdCAgICAgICAgfVxuXHQgICAgfSxcblx0ICAgIHZhbGlkYXRlOiBmdW5jdGlvbiB2YWxpZGF0ZSh2YWx1ZSkge1xuXHQgICAgICAgIHZhciBfdmFsdWUgPSB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiB0aGlzLnN0YXRlLl9mb3JtVmFsdWUsXG5cdCAgICAgICAgICAgIHZhbGlkYXRvcnMgPSB0aGlzLmdldFZhbGlkYXRvcnMoKSxcblx0ICAgICAgICAgICAgZm9ybXN5RXhFcnJvck1zZ3MsXG5cdCAgICAgICAgICAgIGlzQ29udGludWUgPSB0cnVlLFxuXHQgICAgICAgICAgICByZXM7XG5cdCAgICAgICAgdmFsaWRhdG9ycyAmJiAoZm9ybXN5RXhFcnJvck1zZ3MgPSBfLm1hcCh2YWxpZGF0b3JzLCBmdW5jdGlvbiAodmFsaWRhdG9yKSB7XG5cdCAgICAgICAgICAgIGlmIChpc0NvbnRpbnVlID09PSBmYWxzZSkge1xuXHQgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIHJlcyA9IHZhbGlkYXRvcihfdmFsdWUpIHx8IHt9O1xuXHQgICAgICAgICAgICBpZiAocmVzWydjb250aW51ZSddID09PSBmYWxzZSkge1xuXHQgICAgICAgICAgICAgICAgaXNDb250aW51ZSA9IGZhbHNlO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIGlmIChyZXMucmVzID09PSBmYWxzZSkge1xuXHQgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5tc2c7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgcmV0dXJuICcnO1xuXHQgICAgICAgIH0pKTtcblx0ICAgICAgICBmb3Jtc3lFeEVycm9yTXNncyA9IF8uZmlsdGVyKGZvcm1zeUV4RXJyb3JNc2dzLCBmdW5jdGlvbiAoZm9ybXN5RXhFcnJvck1zZykge1xuXHQgICAgICAgICAgICByZXR1cm4gdHJ1ZSAmJiBmb3Jtc3lFeEVycm9yTXNnO1xuXHQgICAgICAgIH0pO1xuXHQgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuXHQgICAgICAgICAgICBfZm9ybVZhbHVlOiBfdmFsdWUsXG5cdCAgICAgICAgICAgIF9mb3Jtc3lFeEVycm9yTXNnczogZm9ybXN5RXhFcnJvck1zZ3Ncblx0ICAgICAgICB9KTtcblx0ICAgICAgICByZXR1cm4gZm9ybXN5RXhFcnJvck1zZ3MubGVuZ3RoID09PSAwO1xuXHQgICAgfSxcblx0ICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcblx0ICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5fZm9ybVZhbHVlO1xuXHQgICAgfSxcblx0ICAgIGdldEVycm9yTXNnOiBmdW5jdGlvbiBnZXRFcnJvck1zZygpIHtcblx0ICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5fZm9ybXN5RXhFcnJvck1zZ3MubGVuZ3RoID09PSAxID8gdGhpcy5zdGF0ZS5fZm9ybXN5RXhFcnJvck1zZ3NbMF0gOiB0aGlzLnN0YXRlLl9mb3Jtc3lFeEVycm9yTXNncztcblx0ICAgIH0sXG5cdCAgICBnZXRWYWxpZGF0b3JzOiBmdW5jdGlvbiBnZXRWYWxpZGF0b3JzKCkge1xuXHQgICAgICAgIHZhciBwcm9wZXJ0eVZhbGlkYXRvciA9IHRoaXMudmFsaWRhdG9ycyAmJiB0aGlzLnZhbGlkYXRvcnMuY2FsbCA/IFt0aGlzLnZhbGlkYXRvcnNdIDogdGhpcy52YWxpZGF0b3JzIHx8IFtdLFxuXHQgICAgICAgICAgICB2YWxpZGF0b3JzID0gcHJvcGVydHlWYWxpZGF0b3IuY29uY2F0KHRoaXMucHJvcHMudmFsaWRhdG9ycyB8fCBbXSk7XG5cdCAgICAgICAgcmV0dXJuIHZhbGlkYXRvcnM7XG5cdCAgICB9XG5cdH07XG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChleHBvcnRzLCAoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KCkpKSlcblxuLyoqKi8gfSxcbi8qIDMgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgX193ZWJwYWNrX3JlcXVpcmVfXygxKSxcblx0ICAgIF8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpO1xuXHRtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiB7XG5cdCAgICAgICAgaXNGb3JtOiB0cnVlLFxuXHQgICAgICAgIHJlZ2lzdGVyOiBmdW5jdGlvbiByZWdpc3RlcihjaGlsZCkge1xuXHQgICAgICAgICAgICB0aGlzLmlucHV0cyA9IHRoaXMuaW5wdXRzIHx8IHt9O1xuXHQgICAgICAgICAgICB0aGlzLmNoaWxkSWQgPSB0aGlzLmNoaWxkSWQgfHwgMDtcblx0ICAgICAgICAgICAgY2hpbGQucmVnSWQgPSBjaGlsZC5wcm9wcy5uYW1lIHx8IHRoaXMuY2hpbGRJZCsrO1xuXHQgICAgICAgICAgICB0aGlzLmlucHV0c1tjaGlsZC5yZWdJZF0gPSBjaGlsZDtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHVucmVnaXN0ZXI6IGZ1bmN0aW9uIHVucmVnaXN0ZXIoY2hpbGQpIHtcblx0ICAgICAgICAgICAgZGVsZXRlIHRoaXMuaW5wdXRzW2NoaWxkLnJlZ0lkXTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gc3VibWl0KGV2ZW50KSB7XG5cdCAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpIHx8IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdCAgICAgICAgICAgIHZhciBmaXJzdEVycm9yQ29tcG9uZW50ID0gdW5kZWZpbmVkO1xuXHQgICAgICAgICAgICBfLmVhY2godGhpcy5pbnB1dHMsIGZ1bmN0aW9uIChjb21wb25lbnQpIHtcblx0ICAgICAgICAgICAgICAgIHZhciByZXMgPSBjb21wb25lbnQudmFsaWRhdGUoKTtcblx0ICAgICAgICAgICAgICAgIGZpcnN0RXJyb3JDb21wb25lbnQgPSBmaXJzdEVycm9yQ29tcG9uZW50ID09PSB1bmRlZmluZWQgJiYgcmVzID09PSBmYWxzZSA/IGNvbXBvbmVudCA6IGZpcnN0RXJyb3JDb21wb25lbnQ7XG5cdCAgICAgICAgICAgIH0pO1xuXHQgICAgICAgICAgICBmaXJzdEVycm9yQ29tcG9uZW50ID09PSB1bmRlZmluZWQgPyB0aGlzLnByb3BzLm9uU3VibWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBmaXJzdEVycm9yQ29tcG9uZW50LmZvY3VzICYmIGZpcnN0RXJyb3JDb21wb25lbnQuZm9jdXMoKTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuXHQgICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcblx0ICAgICAgICAgICAgICAgICdmb3JtJyxcblx0ICAgICAgICAgICAgICAgIHsgb25TdWJtaXQ6IHRoaXMuc3VibWl0LCBzdHlsZTogdGhpcy5wcm9wcy5zdHlsZSwgY2xhc3NOYW1lOiB0aGlzLnByb3BzLmNsYXNzTmFtZSB9LFxuXHQgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5jaGlsZHJlblxuXHQgICAgICAgICAgICApO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cdH07XG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChleHBvcnRzLCAoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KCkpKSlcblxuLyoqKi8gfSxcbi8qIDQgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdG1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV80X187XG5cbi8qKiovIH0sXG4vKiA1ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnO1xuXHR2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblx0XG5cdG1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3MoeyBkaXNwbGF5TmFtZTogJ21vZHVsZS5leHBvcnRzJyxcblx0ICAgIG1peGluczogW19fd2VicGFja19yZXF1aXJlX18oMildLFxuXHQgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG5cdCAgICAgICAgdmFyIGVycm9yTXNnID0gdGhpcy5nZXRFcnJvck1zZygpO1xuXHQgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IHN0eWxlOiB0aGlzLnByb3BzLnN0eWxlIH0sIHRoaXMucHJvcHMuY2hpbGRyZW4sIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJywgeyBzdHlsZTogeyBjb2xvcjogJ3JlZCcgfSB9LCBlcnJvck1zZywgUmVhY3QuY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7IHJlZjogJ2ZvY3VzJywgc3R5bGU6IHsgb3BhY2l0eTogJzAnIH0gfSkpKTtcblx0ICAgIH1cblx0fSk7XG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChleHBvcnRzLCAoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KCkpKSlcblxuLyoqKi8gfSxcbi8qIDYgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7XG5cdHZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpLFxuXHQgICAgb2JqZWN0QXNzaWduID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTtcblx0bW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyhvYmplY3RBc3NpZ24oeyBtaXhpbnM6IFtfX3dlYnBhY2tfcmVxdWlyZV9fKDIpXSB9LCBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpKCkpKTtcblx0LyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKGV4cG9ydHMsIChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0oKSkpKVxuXG4vKioqLyB9LFxuLyogNyAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXHR2YXIgcHJvcElzRW51bWVyYWJsZSA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGU7XG5cdFxuXHRmdW5jdGlvbiBUb09iamVjdCh2YWwpIHtcblx0XHRpZiAodmFsID09IG51bGwpIHtcblx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5hc3NpZ24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIG51bGwgb3IgdW5kZWZpbmVkJyk7XG5cdFx0fVxuXHRcblx0XHRyZXR1cm4gT2JqZWN0KHZhbCk7XG5cdH1cblx0XG5cdGZ1bmN0aW9uIG93bkVudW1lcmFibGVLZXlzKG9iaikge1xuXHRcdHZhciBrZXlzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqKTtcblx0XG5cdFx0aWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcblx0XHRcdGtleXMgPSBrZXlzLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iaikpO1xuXHRcdH1cblx0XG5cdFx0cmV0dXJuIGtleXMuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHtcblx0XHRcdHJldHVybiBwcm9wSXNFbnVtZXJhYmxlLmNhbGwob2JqLCBrZXkpO1xuXHRcdH0pO1xuXHR9XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7XG5cdFx0dmFyIGZyb207XG5cdFx0dmFyIGtleXM7XG5cdFx0dmFyIHRvID0gVG9PYmplY3QodGFyZ2V0KTtcblx0XG5cdFx0Zm9yICh2YXIgcyA9IDE7IHMgPCBhcmd1bWVudHMubGVuZ3RoOyBzKyspIHtcblx0XHRcdGZyb20gPSBhcmd1bWVudHNbc107XG5cdFx0XHRrZXlzID0gb3duRW51bWVyYWJsZUtleXMoT2JqZWN0KGZyb20pKTtcblx0XG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0dG9ba2V5c1tpXV0gPSBmcm9tW2tleXNbaV1dO1xuXHRcdFx0fVxuXHRcdH1cblx0XG5cdFx0cmV0dXJuIHRvO1xuXHR9O1xuXG5cbi8qKiovIH1cbi8qKioqKiovIF0pXG59KTtcbjtcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiBmb3Jtc3lFeC1yZWFjdC5qc1xuICoqLyIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRleHBvcnRzOiB7fSxcbiBcdFx0XHRpZDogbW9kdWxlSWQsXG4gXHRcdFx0bG9hZGVkOiBmYWxzZVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogd2VicGFjay9ib290c3RyYXAgZjlmNjAxMmEyYjVhYzc1ZDY1Y2FcbiAqKi8iLCJ2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgcmVxdWlyZSgncmVhY3QnKSxcbiAgICBGb3Jtc3lFeCA9IHt9LFxuICAgIEZvcm0gPSByZXF1aXJlKCcuL0Zvcm0uanN4JyksXG4gICAgQmxvY2sgPSByZXF1aXJlKCcuL0Jsb2NrLmpzeCcpLFxuICAgIE1peGluID0gcmVxdWlyZSgnLi9NaXhpbi5qcycpO1xuXG5Gb3Jtc3lFeC5NaXhpbiA9IE1peGluO1xuRm9ybXN5RXguRm9ybSA9IEZvcm07XG5Gb3Jtc3lFeC5CbG9jayA9IEJsb2NrO1xuXG5pZiAoIWdsb2JhbC5leHBvcnRzICYmICFnbG9iYWwubW9kdWxlICYmICghZ2xvYmFsLmRlZmluZSB8fCAhZ2xvYmFsLmRlZmluZS5hbWQpKSB7XG4gIGdsb2JhbC5Gb3Jtc3lFeCA9IEZvcm1zeUV4O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZvcm1zeUV4O1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9saWIvbWFpbi5qc1xuICoqLyIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX187XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiBleHRlcm5hbCBcInJlYWN0XCJcbiAqKiBtb2R1bGUgaWQgPSAxXG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCJ2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgcmVxdWlyZSgncmVhY3QnKSxcbiAgICBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpLFxuICAgIHJlZ0Zvcm1zID0ge30sXG4gICAgbW9ja0Zvcm0gPSByZXF1aXJlKCcuL2Zvcm0nKSxcbiAgICBkZWZhdWx0Rm9ybSA9ICdfREVGQVVMVF9GT1JNJztcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgZm9jdXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gaWYgKCF0aGlzLnJlZnMuZm9jdXMpIHtcbiAgICAgICAgLy8gICAgdGhyb3cgbmV3IEVycm9yKCdzaG91bGQgaGF2ZSBhIGNoaWxkIGNvbXBvbmVudCB3aXRoIHJlZiBuYW1lIGBpbnB1dGAsIG1vc3Qgb2YgdGhlIGNhc2UgcmVmIGlzIHNldCBvbiBFcnJvck1zZ0xhYmVsJyk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgUmVhY3QuZmluZERPTU5vZGUodGhpcy5yZWZzLmZvY3VzKSAmJlxuICAgICAgICAgICAgUmVhY3QuZmluZERPTU5vZGUodGhpcy5yZWZzLmZvY3VzKS5mb2N1cygpO1xuICAgIH0sXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfZm9ybXN5RXhWYWx1ZTogJycsXG4gICAgICAgICAgICBfZm9ybXN5RXhFcnJvck1zZ3M6IFtdXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBjb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXM7XG4gICAgICAgIGlmIChjb21wb25lbnQuaXNJbml0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb21wb25lbnQuaXNGb3JtKSB7IC8vIGZvcm1cbiAgICAgICAgICAgIC8vIGZvcm0gb2JqZWN0XG4gICAgICAgICAgICB2YXIgZm9ybU5hbWUgPSBjb21wb25lbnQucHJvcHMubmFtZSA/IGNvbXBvbmVudC5wcm9wcy5uYW1lIDogZGVmYXVsdEZvcm07XG4gICAgICAgICAgICBpZiAocmVnRm9ybXNbZm9ybU5hbWVdKSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmlucHV0cyA9IHJlZ0Zvcm1zW2Zvcm1OYW1lXS5pbnB1dHM7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNoaWxkSWQgPSByZWdGb3Jtc1tmb3JtTmFtZV0uY2hpbGRJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZ0Zvcm1zW2Zvcm1OYW1lXSA9IGNvbXBvbmVudDtcbiAgICAgICAgICAgIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goXG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wcm9wcy5yZWdGb3JtICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnByb3BzLnJlZ0Zvcm0gIT09IGZvcm1OYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29tcG9uZW50cyBhcmUgcmVnaXN0ZXJlZCB0byBhbm90aGVyIGZvcm1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50LnJlZ2lzdGVyKGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQuaXNJbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgeyAvLyBlbGVtZW50cyBpbiBmb3JtXG4gICAgICAgICAgICB2YXIgcmVnVG9Gb3JtTmFtZTtcbiAgICAgICAgICAgIC8vIGlmICghdGhpcy52YWxpZGF0b3IgfHwgIXRoaXMudmFsaWRhdG9yLmNhbGwpIHtcbiAgICAgICAgICAgIC8vICAgIHRocm93IG5ldyBFcnJvcignc2hvdWxkIGltcGxlbWVudCBgZm9jdXNgIGFuZCBgdmFsaWRhdG9yYCBmdW5jdGlvbicpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgcmVnVG9Gb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtID8gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gOiBkZWZhdWx0Rm9ybTtcbiAgICAgICAgICAgIGlmIChyZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0gPSBtb2NrRm9ybSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0ucmVnaXN0ZXIoY29tcG9uZW50KTtcbiAgICAgICAgfVxuICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gdHJ1ZTtcbiAgICB9LFxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb21wb25lbnQgPSB0aGlzO1xuICAgICAgICBpZiAoIWNvbXBvbmVudC5pc0luaXQpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbXBvbmVudC5pc0Zvcm0pIHsgLy8gZm9ybVxuICAgICAgICAgICAgLy8gZm9ybSBvYmplY3RcbiAgICAgICAgICAgIHZhciBmb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5uYW1lID8gY29tcG9uZW50LnByb3BzLm5hbWUgOiBkZWZhdWx0Rm9ybTtcbiAgICAgICAgICAgIGRlbGV0ZSByZWdGb3Jtc1tmb3JtTmFtZV07XG4gICAgICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7IC8vIGVsZW1lbnRzIGluIGZvcm1cbiAgICAgICAgICAgIHZhciByZWdUb0Zvcm1OYW1lID0gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gPyBjb21wb25lbnQucHJvcHMucmVnRm9ybSA6IGRlZmF1bHRGb3JtO1xuICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0gPyAocmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0udW5yZWdpc3Rlcihjb21wb25lbnQpKSA6IHVuZGVmaW5lZCA7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdmFyIF92YWx1ZSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHRoaXMuc3RhdGUuX2Zvcm1WYWx1ZSxcbiAgICAgICAgICAgIHZhbGlkYXRvcnMgPSB0aGlzLmdldFZhbGlkYXRvcnMoKSxcbiAgICAgICAgICAgIGZvcm1zeUV4RXJyb3JNc2dzLFxuICAgICAgICAgICAgaXNDb250aW51ZSA9IHRydWUsXG4gICAgICAgICAgICByZXM7XG4gICAgICAgIHZhbGlkYXRvcnMgJiZcbiAgICAgICAgICAgIChmb3Jtc3lFeEVycm9yTXNncyA9IF8ubWFwKHZhbGlkYXRvcnMsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb250aW51ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXMgPSB2YWxpZGF0b3IoX3ZhbHVlKSB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5jb250aW51ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29udGludWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzLnJlcyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMubXNnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApKTtcbiAgICAgICAgZm9ybXN5RXhFcnJvck1zZ3MgPSBfLmZpbHRlcihcbiAgICAgICAgICAgIGZvcm1zeUV4RXJyb3JNc2dzLFxuICAgICAgICAgICAgZnVuY3Rpb24gKGZvcm1zeUV4RXJyb3JNc2cpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZSAmJiBmb3Jtc3lFeEVycm9yTXNnO1xuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgX2Zvcm1WYWx1ZTogX3ZhbHVlLFxuICAgICAgICAgICAgICAgIF9mb3Jtc3lFeEVycm9yTXNnczogZm9ybXN5RXhFcnJvck1zZ3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGZvcm1zeUV4RXJyb3JNc2dzLmxlbmd0aCA9PT0gMDtcbiAgICB9LFxuICAgIGdldFZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLl9mb3JtVmFsdWU7XG4gICAgfSxcbiAgICBnZXRFcnJvck1zZzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5fZm9ybXN5RXhFcnJvck1zZ3MubGVuZ3RoID09PSAxID9cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLl9mb3Jtc3lFeEVycm9yTXNnc1swXSA6IHRoaXMuc3RhdGUuX2Zvcm1zeUV4RXJyb3JNc2dzO1xuICAgIH0sXG4gICAgZ2V0VmFsaWRhdG9yczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcHJvcGVydHlWYWxpZGF0b3IgPSAgdGhpcy52YWxpZGF0b3JzICYmIHRoaXMudmFsaWRhdG9ycy5jYWxsID9cbiAgICAgICAgICAgIFt0aGlzLnZhbGlkYXRvcnNdIDpcbiAgICAgICAgICAgICh0aGlzLnZhbGlkYXRvcnMgfHwgW10pLFxuICAgICAgICAgICAgdmFsaWRhdG9ycyA9IHByb3BlcnR5VmFsaWRhdG9yLmNvbmNhdCh0aGlzLnByb3BzLnZhbGlkYXRvcnMgfHwgW10pO1xuICAgICAgICByZXR1cm4gdmFsaWRhdG9ycztcbiAgICB9XG59XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL2xpYi9NaXhpbi5qc1xuICoqLyIsInZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCByZXF1aXJlKCdyZWFjdCcpLFxuICAgIF8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpc0Zvcm06IHRydWUsXG4gICAgICAgIHJlZ2lzdGVyOiBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzID0gdGhpcy5pbnB1dHMgfHwge307XG4gICAgICAgICAgICB0aGlzLmNoaWxkSWQgPSB0aGlzLmNoaWxkSWQgfHwgMDtcbiAgICAgICAgICAgIGNoaWxkLnJlZ0lkID0gY2hpbGQucHJvcHMubmFtZSB8fCB0aGlzLmNoaWxkSWQrKztcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzW2NoaWxkLnJlZ0lkXSA9IGNoaWxkO1xuICAgICAgICB9LFxuICAgICAgICB1bnJlZ2lzdGVyOiBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmlucHV0c1tjaGlsZC5yZWdJZF07XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKSB8fCBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIGZpcnN0RXJyb3JDb21wb25lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dHMsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSBjb21wb25lbnQudmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0RXJyb3JDb21wb25lbnQgPSAoZmlyc3RFcnJvckNvbXBvbmVudCA9PT0gdW5kZWZpbmVkICYmIHJlcyA9PT0gZmFsc2UpID8gY29tcG9uZW50OiBmaXJzdEVycm9yQ29tcG9uZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGZpcnN0RXJyb3JDb21wb25lbnQgPT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vblN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDpcbiAgICAgICAgICAgICAgICBmaXJzdEVycm9yQ29tcG9uZW50LmZvY3VzICYmIGZpcnN0RXJyb3JDb21wb25lbnQuZm9jdXMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxmb3JtIG9uU3VibWl0PXt0aGlzLnN1Ym1pdH0gc3R5bGU9e3RoaXMucHJvcHMuc3R5bGV9IGNsYXNzTmFtZT17dGhpcy5wcm9wcy5jbGFzc05hbWV9PlxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfTtcbn07XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL2xpYi9mb3JtLmpzXG4gKiovIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzRfXztcblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIGV4dGVybmFsIFwidW5kZXJzY29yZVwiXG4gKiogbW9kdWxlIGlkID0gNFxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwiJ3VzZSBzdHJpY3QnO1xudmFyIFJlYWN0ID0gZ2xvYmFsLlJlYWN0IHx8IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiBcIm1vZHVsZS5leHBvcnRzXCIsXG4gICAgbWl4aW5zOiBbXG4gICAgICAgcmVxdWlyZSgnLi9NaXhpbicpXG4gICAgXSxcbiAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVycm9yTXNnID0gdGhpcy5nZXRFcnJvck1zZygpO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7c3R5bGU6IHRoaXMucHJvcHMuc3R5bGV9LCBcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmNoaWxkcmVuLCBcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIiwge3N0eWxlOiB7Y29sb3I6ICdyZWQnfX0sIGVycm9yTXNnLCBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwge3JlZjogXCJmb2N1c1wiLCBzdHlsZToge29wYWNpdHk6ICcwJ319KSlcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG59KTtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vbGliL0Jsb2NrLmpzeFxuICoqLyIsIid1c2Ugc3RyaWN0JztcbnZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCByZXF1aXJlKCdyZWFjdCcpLFxuICAgIG9iamVjdEFzc2lnbiA9IHJlcXVpcmUoJ29iamVjdC1hc3NpZ24nKTtcbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Mob2JqZWN0QXNzaWduKHttaXhpbnM6IFtyZXF1aXJlKCcuL01peGluJyldfSwgcmVxdWlyZSgnLi9mb3JtJykoKSkpO1xuXG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL2xpYi9Gb3JtLmpzeFxuICoqLyIsIid1c2Ugc3RyaWN0JztcbnZhciBwcm9wSXNFbnVtZXJhYmxlID0gT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTtcblxuZnVuY3Rpb24gVG9PYmplY3QodmFsKSB7XG5cdGlmICh2YWwgPT0gbnVsbCkge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5hc3NpZ24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIG51bGwgb3IgdW5kZWZpbmVkJyk7XG5cdH1cblxuXHRyZXR1cm4gT2JqZWN0KHZhbCk7XG59XG5cbmZ1bmN0aW9uIG93bkVudW1lcmFibGVLZXlzKG9iaikge1xuXHR2YXIga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKG9iaik7XG5cblx0aWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcblx0XHRrZXlzID0ga2V5cy5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmopKTtcblx0fVxuXG5cdHJldHVybiBrZXlzLmZpbHRlcihmdW5jdGlvbiAoa2V5KSB7XG5cdFx0cmV0dXJuIHByb3BJc0VudW1lcmFibGUuY2FsbChvYmosIGtleSk7XG5cdH0pO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7XG5cdHZhciBmcm9tO1xuXHR2YXIga2V5cztcblx0dmFyIHRvID0gVG9PYmplY3QodGFyZ2V0KTtcblxuXHRmb3IgKHZhciBzID0gMTsgcyA8IGFyZ3VtZW50cy5sZW5ndGg7IHMrKykge1xuXHRcdGZyb20gPSBhcmd1bWVudHNbc107XG5cdFx0a2V5cyA9IG93bkVudW1lcmFibGVLZXlzKE9iamVjdChmcm9tKSk7XG5cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHRvW2tleXNbaV1dID0gZnJvbVtrZXlzW2ldXTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gdG87XG59O1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL34vb2JqZWN0LWFzc2lnbi9pbmRleC5qc1xuICoqIG1vZHVsZSBpZCA9IDdcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyJdLCJzb3VyY2VSb290IjoiIn0=