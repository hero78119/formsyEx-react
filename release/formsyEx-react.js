!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("react"),require("underscore")):"function"==typeof define&&define.amd?define(["react","underscore"],r):"object"==typeof exports?exports.FormsyEx=r(require("react"),require("underscore")):t.FormsyEx=r(t.react,t.underscore)}(this,function(t,r){return function(t){function r(s){if(e[s])return e[s].exports;var i=e[s]={exports:{},id:s,loaded:!1};return t[s].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r,e){(function(r){"use strict";var s={},i=e(6),o=e(5),n=e(2);s.Mixin=n,s.Form=i,s.Block=o,r.exports||r.module||r.define&&r.define.amd||(r.FormsyEx=s),t.exports=s}).call(r,function(){return this}())},function(r,e){r.exports=t},function(t,r,e){(function(r){"use strict";var s=r.React||e(1),i=e(4),o={},n=e(3),u="_DEFAULT_FORM";t.exports={focus:function(){s.findDOMNode(this.refs.focus)&&s.findDOMNode(this.refs.focus).focus()},getInitialState:function(){return{_formsyExValue:"",_formsyExErrorMsgs:[]}},componentWillMount:function(){var t=this;if(t.isInit===!0)return void 0;if(t.isForm){var r=t.props.name?t.props.name:u;o[r]&&(t.inputs=o[r].inputs,t.childId=o[r].childId),o[r]=t,s.Children.forEach(t.children,function(e){return void 0!==e.props.regForm&&e.props.regForm!==r?void 0:(t.register(e),void(e.isInit=!0))})}else{var e;e=t.props.regForm?t.props.regForm:u,void 0===o[e]&&(o[e]=n()),o[e].register(t)}t.isInit=!0},componentWillUnmount:function(){var t=this;if(!t.isInit)return void 0;if(t.isForm){var r=t.props.name?t.props.name:u;delete o[r],t.isInit=!1}else{var e=t.props.regForm?t.props.regForm:u;o[e]?o[e].unregister(t):void 0}},validate:function(t){var r,e,s=void 0!==t?t:this.state._formValue,o=this.getValidators(),n=!0;return o&&(r=i.map(o,function(t){return n===!1?"":(e=t(s)||{},e["continue"]===!1&&(n=!1),e.res===!1?e.msg:"")})),r=i.filter(r,function(t){return!0&&t}),this.setState({_formValue:s,_formsyExErrorMsgs:r}),0===r.length},getValue:function(){return this.state._formValue},getErrorMsg:function(){return 1===this.state._formsyExErrorMsgs.length?this.state._formsyExErrorMsgs[0]:this.state._formsyExErrorMsgs},getValidators:function(){var t=this.validators&&this.validators.call?[this.validators]:this.validators||[],r=t.concat(this.props.validators||[]);return r}}}).call(r,function(){return this}())},function(t,r,e){(function(r){"use strict";var s=r.React||e(1),i=e(4);t.exports=function(){return{isForm:!0,register:function(t){this.inputs=this.inputs||{},this.childId=this.childId||0,t.regId=t.props.name||this.childId++,this.inputs[t.regId]=t},unregister:function(t){delete this.inputs[t.regId]},submit:function(t){t.stopPropagation()||t.preventDefault();var r=void 0;i.each(this.inputs,function(t){var e=t.validate();r=void 0===r&&e===!1?t:r}),void 0===r?this.props.onSubmit.apply(this,arguments):r.focus&&r.focus()},render:function(){return s.createElement("form",{onSubmit:this.submit,style:this.props.style,className:this.props.className},this.props.children)}}}}).call(r,function(){return this}())},function(t,e){t.exports=r},function(t,r,e){(function(r){"use strict";var s=r.React||e(1);t.exports=s.createClass({displayName:"module.exports",mixins:[e(2)],render:function(){var t=this.getErrorMsg();return s.createElement("div",{style:this.props.style},this.props.children,s.createElement("label",{style:{color:"red"}},t,s.createElement("input",{ref:"focus",style:{opacity:"0"}})))}})}).call(r,function(){return this}())},function(t,r,e){(function(r){"use strict";var s=r.React||e(1),i=e(3)();i.mixins=[e(2)],t.exports=s.createClass(i)}).call(r,function(){return this}())}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy9mb3Jtc3lFeC1yZWFjdC5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgZjI1ZjViMmVhMWMzYTlmYWZhM2YiLCJ3ZWJwYWNrOi8vLy4vbGliL21haW4uanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwicmVhY3RcIiIsIndlYnBhY2s6Ly8vLi9saWIvTWl4aW4uanMiLCJ3ZWJwYWNrOi8vLy4vbGliL2Zvcm0uanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwidW5kZXJzY29yZVwiIiwid2VicGFjazovLy8uL2xpYi9CbG9jay5qc3giLCJ3ZWJwYWNrOi8vLy4vbGliL0Zvcm0uanN4Il0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX18iLCJfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzRfXyIsIm1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpbnN0YWxsZWRNb2R1bGVzIiwiaWQiLCJsb2FkZWQiLCJjYWxsIiwibSIsImMiLCJwIiwiZ2xvYmFsIiwiRm9ybXN5RXgiLCJGb3JtIiwiQmxvY2siLCJNaXhpbiIsIlJlYWN0IiwiXyIsInJlZ0Zvcm1zIiwibW9ja0Zvcm0iLCJkZWZhdWx0Rm9ybSIsImZvY3VzIiwiZmluZERPTU5vZGUiLCJyZWZzIiwiZ2V0SW5pdGlhbFN0YXRlIiwiX2Zvcm1zeUV4VmFsdWUiLCJfZm9ybXN5RXhFcnJvck1zZ3MiLCJjb21wb25lbnRXaWxsTW91bnQiLCJjb21wb25lbnQiLCJpc0luaXQiLCJ1bmRlZmluZWQiLCJpc0Zvcm0iLCJmb3JtTmFtZSIsInByb3BzIiwibmFtZSIsImlucHV0cyIsImNoaWxkSWQiLCJDaGlsZHJlbiIsImZvckVhY2giLCJjaGlsZHJlbiIsImNoaWxkIiwicmVnRm9ybSIsInJlZ2lzdGVyIiwicmVnVG9Gb3JtTmFtZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwidW5yZWdpc3RlciIsInZhbGlkYXRlIiwidmFsdWUiLCJmb3Jtc3lFeEVycm9yTXNncyIsInJlcyIsIl92YWx1ZSIsInN0YXRlIiwiX2Zvcm1WYWx1ZSIsInZhbGlkYXRvcnMiLCJnZXRWYWxpZGF0b3JzIiwiaXNDb250aW51ZSIsIm1hcCIsInZhbGlkYXRvciIsIm1zZyIsImZpbHRlciIsImZvcm1zeUV4RXJyb3JNc2ciLCJzZXRTdGF0ZSIsImxlbmd0aCIsImdldFZhbHVlIiwiZ2V0RXJyb3JNc2ciLCJwcm9wZXJ0eVZhbGlkYXRvciIsImNvbmNhdCIsInJlZ0lkIiwic3VibWl0IiwiZXZlbnQiLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImZpcnN0RXJyb3JDb21wb25lbnQiLCJlYWNoIiwib25TdWJtaXQiLCJhcHBseSIsImFyZ3VtZW50cyIsInJlbmRlciIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImNsYXNzTmFtZSIsImNyZWF0ZUNsYXNzIiwiZGlzcGxheU5hbWUiLCJtaXhpbnMiLCJlcnJvck1zZyIsImNvbG9yIiwicmVmIiwib3BhY2l0eSIsImZvcm0iXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsZ0JBQUFDLFVBQUEsZ0JBQUFDLFFBQ0FBLE9BQUFELFFBQUFELEVBQUFHLFFBQUEsU0FBQUEsUUFBQSxlQUNBLGtCQUFBQyxnQkFBQUMsSUFDQUQsUUFBQSxzQkFBQUosR0FDQSxnQkFBQUMsU0FDQUEsUUFBQSxTQUFBRCxFQUFBRyxRQUFBLFNBQUFBLFFBQUEsZUFFQUosRUFBQSxTQUFBQyxFQUFBRCxFQUFBLE1BQUFBLEVBQUEsYUFDQ08sS0FBQSxTQUFBQyxFQUFBQyxHQUNELE1DQWdCLFVBQVVDLEdDTjFCLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsRUFBQUQsR0FDQSxNQUFBQyxHQUFBRCxHQUFB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QnNGLEdBQWEsUUFBS3RGLEVBQVEsSUFDMUJSLEVBQU9ELFFBQVV1QixFQUFNaUUsWUFBWU8sS1J1UUxqRixLQUFLZCxFQUFVLFdBQWEsTUFBT0siLCJmaWxlIjoiZm9ybXN5RXgtcmVhY3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoXCJyZWFjdFwiKSwgcmVxdWlyZShcInVuZGVyc2NvcmVcIikpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW1wicmVhY3RcIiwgXCJ1bmRlcnNjb3JlXCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIkZvcm1zeUV4XCJdID0gZmFjdG9yeShyZXF1aXJlKFwicmVhY3RcIiksIHJlcXVpcmUoXCJ1bmRlcnNjb3JlXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJGb3Jtc3lFeFwiXSA9IGZhY3Rvcnkocm9vdFtcInJlYWN0XCJdLCByb290W1widW5kZXJzY29yZVwiXSk7XG59KSh0aGlzLCBmdW5jdGlvbihfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzFfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV80X18pIHtcbnJldHVybiBcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiB3ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb25cbiAqKi8iLCIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoXCJyZWFjdFwiKSwgcmVxdWlyZShcInVuZGVyc2NvcmVcIikpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW1wicmVhY3RcIiwgXCJ1bmRlcnNjb3JlXCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIkZvcm1zeUV4XCJdID0gZmFjdG9yeShyZXF1aXJlKFwicmVhY3RcIiksIHJlcXVpcmUoXCJ1bmRlcnNjb3JlXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJGb3Jtc3lFeFwiXSA9IGZhY3Rvcnkocm9vdFtcInJlYWN0XCJdLCByb290W1widW5kZXJzY29yZVwiXSk7XG59KSh0aGlzLCBmdW5jdGlvbihfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzFfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV80X18pIHtcbnJldHVybiAvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4vKioqKioqLyBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4vKioqKioqLyBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fSxcbi8qKioqKiovIFx0XHRcdGlkOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGxvYWRlZDogZmFsc2Vcbi8qKioqKiovIFx0XHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbi8qKioqKiovIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuLyoqKioqKi8gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuLyoqKioqKi9cbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgRm9ybXN5RXggPSB7fSxcblx0ICAgIEZvcm0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpLFxuXHQgICAgQmxvY2sgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpLFxuXHQgICAgTWl4aW4gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpO1xuXHRcblx0Rm9ybXN5RXguTWl4aW4gPSBNaXhpbjtcblx0Rm9ybXN5RXguRm9ybSA9IEZvcm07XG5cdEZvcm1zeUV4LkJsb2NrID0gQmxvY2s7XG5cdFxuXHRpZiAoIWdsb2JhbC5leHBvcnRzICYmICFnbG9iYWwubW9kdWxlICYmICghZ2xvYmFsLmRlZmluZSB8fCAhZ2xvYmFsLmRlZmluZS5hbWQpKSB7XG5cdCAgICBnbG9iYWwuRm9ybXN5RXggPSBGb3Jtc3lFeDtcblx0fVxuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBGb3Jtc3lFeDtcblx0LyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKGV4cG9ydHMsIChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0oKSkpKVxuXG4vKioqLyB9LFxuLyogMSAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0bW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzFfXztcblxuLyoqKi8gfSxcbi8qIDIgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgX193ZWJwYWNrX3JlcXVpcmVfXygxKSxcblx0ICAgIF8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpLFxuXHQgICAgcmVnRm9ybXMgPSB7fSxcblx0ICAgIG1vY2tGb3JtID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKSxcblx0ICAgIGRlZmF1bHRGb3JtID0gJ19ERUZBVUxUX0ZPUk0nO1xuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSB7XG5cdCAgICBmb2N1czogZnVuY3Rpb24gZm9jdXMoKSB7XG5cdCAgICAgICAgLy8gaWYgKCF0aGlzLnJlZnMuZm9jdXMpIHtcblx0ICAgICAgICAvLyAgICB0aHJvdyBuZXcgRXJyb3IoJ3Nob3VsZCBoYXZlIGEgY2hpbGQgY29tcG9uZW50IHdpdGggcmVmIG5hbWUgYGlucHV0YCwgbW9zdCBvZiB0aGUgY2FzZSByZWYgaXMgc2V0IG9uIEVycm9yTXNnTGFiZWwnKTtcblx0ICAgICAgICAvLyB9XG5cdCAgICAgICAgUmVhY3QuZmluZERPTU5vZGUodGhpcy5yZWZzLmZvY3VzKSAmJiBSZWFjdC5maW5kRE9NTm9kZSh0aGlzLnJlZnMuZm9jdXMpLmZvY3VzKCk7XG5cdCAgICB9LFxuXHQgICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiBnZXRJbml0aWFsU3RhdGUoKSB7XG5cdCAgICAgICAgcmV0dXJuIHtcblx0ICAgICAgICAgICAgX2Zvcm1zeUV4VmFsdWU6ICcnLFxuXHQgICAgICAgICAgICBfZm9ybXN5RXhFcnJvck1zZ3M6IFtdXG5cdCAgICAgICAgfTtcblx0ICAgIH0sXG5cdCAgICBjb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxNb3VudCgpIHtcblx0ICAgICAgICB2YXIgY29tcG9uZW50ID0gdGhpcztcblx0ICAgICAgICBpZiAoY29tcG9uZW50LmlzSW5pdCA9PT0gdHJ1ZSkge1xuXHQgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBpZiAoY29tcG9uZW50LmlzRm9ybSkge1xuXHQgICAgICAgICAgICAvLyBmb3JtXG5cdCAgICAgICAgICAgIC8vIGZvcm0gb2JqZWN0XG5cdCAgICAgICAgICAgIHZhciBmb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5uYW1lID8gY29tcG9uZW50LnByb3BzLm5hbWUgOiBkZWZhdWx0Rm9ybTtcblx0ICAgICAgICAgICAgaWYgKHJlZ0Zvcm1zW2Zvcm1OYW1lXSkge1xuXHQgICAgICAgICAgICAgICAgY29tcG9uZW50LmlucHV0cyA9IHJlZ0Zvcm1zW2Zvcm1OYW1lXS5pbnB1dHM7XG5cdCAgICAgICAgICAgICAgICBjb21wb25lbnQuY2hpbGRJZCA9IHJlZ0Zvcm1zW2Zvcm1OYW1lXS5jaGlsZElkO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIHJlZ0Zvcm1zW2Zvcm1OYW1lXSA9IGNvbXBvbmVudDtcblx0ICAgICAgICAgICAgUmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjb21wb25lbnQuY2hpbGRyZW4sIGZ1bmN0aW9uIChjaGlsZCkge1xuXHQgICAgICAgICAgICAgICAgaWYgKGNoaWxkLnByb3BzLnJlZ0Zvcm0gIT09IHVuZGVmaW5lZCAmJiBjaGlsZC5wcm9wcy5yZWdGb3JtICE9PSBmb3JtTmFtZSkge1xuXHQgICAgICAgICAgICAgICAgICAgIC8vIGNvbXBvbmVudHMgYXJlIHJlZ2lzdGVyZWQgdG8gYW5vdGhlciBmb3JtXG5cdCAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcblx0ICAgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgICAgIGNvbXBvbmVudC5yZWdpc3RlcihjaGlsZCk7XG5cdCAgICAgICAgICAgICAgICBjaGlsZC5pc0luaXQgPSB0cnVlO1xuXHQgICAgICAgICAgICB9KTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICAvLyBlbGVtZW50cyBpbiBmb3JtXG5cdCAgICAgICAgICAgIHZhciByZWdUb0Zvcm1OYW1lO1xuXHQgICAgICAgICAgICAvLyBpZiAoIXRoaXMudmFsaWRhdG9yIHx8ICF0aGlzLnZhbGlkYXRvci5jYWxsKSB7XG5cdCAgICAgICAgICAgIC8vICAgIHRocm93IG5ldyBFcnJvcignc2hvdWxkIGltcGxlbWVudCBgZm9jdXNgIGFuZCBgdmFsaWRhdG9yYCBmdW5jdGlvbicpO1xuXHQgICAgICAgICAgICAvLyB9XG5cdCAgICAgICAgICAgIHJlZ1RvRm9ybU5hbWUgPSBjb21wb25lbnQucHJvcHMucmVnRm9ybSA/IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtIDogZGVmYXVsdEZvcm07XG5cdCAgICAgICAgICAgIGlmIChyZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXSA9PT0gdW5kZWZpbmVkKSB7XG5cdCAgICAgICAgICAgICAgICByZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXSA9IG1vY2tGb3JtKCk7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0ucmVnaXN0ZXIoY29tcG9uZW50KTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgY29tcG9uZW50LmlzSW5pdCA9IHRydWU7XG5cdCAgICB9LFxuXHQgICAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuXHQgICAgICAgIHZhciBjb21wb25lbnQgPSB0aGlzO1xuXHQgICAgICAgIGlmICghY29tcG9uZW50LmlzSW5pdCkge1xuXHQgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBpZiAoY29tcG9uZW50LmlzRm9ybSkge1xuXHQgICAgICAgICAgICAvLyBmb3JtXG5cdCAgICAgICAgICAgIC8vIGZvcm0gb2JqZWN0XG5cdCAgICAgICAgICAgIHZhciBmb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5uYW1lID8gY29tcG9uZW50LnByb3BzLm5hbWUgOiBkZWZhdWx0Rm9ybTtcblx0ICAgICAgICAgICAgZGVsZXRlIHJlZ0Zvcm1zW2Zvcm1OYW1lXTtcblx0ICAgICAgICAgICAgY29tcG9uZW50LmlzSW5pdCA9IGZhbHNlO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgIC8vIGVsZW1lbnRzIGluIGZvcm1cblx0ICAgICAgICAgICAgdmFyIHJlZ1RvRm9ybU5hbWUgPSBjb21wb25lbnQucHJvcHMucmVnRm9ybSA/IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtIDogZGVmYXVsdEZvcm07XG5cdCAgICAgICAgICAgIHJlZ0Zvcm1zW3JlZ1RvRm9ybU5hbWVdID8gcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0udW5yZWdpc3Rlcihjb21wb25lbnQpIDogdW5kZWZpbmVkO1xuXHQgICAgICAgIH1cblx0ICAgIH0sXG5cdCAgICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsdWUpIHtcblx0ICAgICAgICB2YXIgX3ZhbHVlID0gdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDogdGhpcy5zdGF0ZS5fZm9ybVZhbHVlLFxuXHQgICAgICAgICAgICB2YWxpZGF0b3JzID0gdGhpcy5nZXRWYWxpZGF0b3JzKCksXG5cdCAgICAgICAgICAgIGZvcm1zeUV4RXJyb3JNc2dzLFxuXHQgICAgICAgICAgICBpc0NvbnRpbnVlID0gdHJ1ZSxcblx0ICAgICAgICAgICAgcmVzO1xuXHQgICAgICAgIHZhbGlkYXRvcnMgJiYgKGZvcm1zeUV4RXJyb3JNc2dzID0gXy5tYXAodmFsaWRhdG9ycywgZnVuY3Rpb24gKHZhbGlkYXRvcikge1xuXHQgICAgICAgICAgICBpZiAoaXNDb250aW51ZSA9PT0gZmFsc2UpIHtcblx0ICAgICAgICAgICAgICAgIHJldHVybiAnJztcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICByZXMgPSB2YWxpZGF0b3IoX3ZhbHVlKSB8fCB7fTtcblx0ICAgICAgICAgICAgaWYgKHJlc1snY29udGludWUnXSA9PT0gZmFsc2UpIHtcblx0ICAgICAgICAgICAgICAgIGlzQ29udGludWUgPSBmYWxzZTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICBpZiAocmVzLnJlcyA9PT0gZmFsc2UpIHtcblx0ICAgICAgICAgICAgICAgIHJldHVybiByZXMubXNnO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIHJldHVybiAnJztcblx0ICAgICAgICB9KSk7XG5cdCAgICAgICAgZm9ybXN5RXhFcnJvck1zZ3MgPSBfLmZpbHRlcihmb3Jtc3lFeEVycm9yTXNncywgZnVuY3Rpb24gKGZvcm1zeUV4RXJyb3JNc2cpIHtcblx0ICAgICAgICAgICAgcmV0dXJuIHRydWUgJiYgZm9ybXN5RXhFcnJvck1zZztcblx0ICAgICAgICB9KTtcblx0ICAgICAgICB0aGlzLnNldFN0YXRlKHtcblx0ICAgICAgICAgICAgX2Zvcm1WYWx1ZTogX3ZhbHVlLFxuXHQgICAgICAgICAgICBfZm9ybXN5RXhFcnJvck1zZ3M6IGZvcm1zeUV4RXJyb3JNc2dzXG5cdCAgICAgICAgfSk7XG5cdCAgICAgICAgcmV0dXJuIGZvcm1zeUV4RXJyb3JNc2dzLmxlbmd0aCA9PT0gMDtcblx0ICAgIH0sXG5cdCAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG5cdCAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuX2Zvcm1WYWx1ZTtcblx0ICAgIH0sXG5cdCAgICBnZXRFcnJvck1zZzogZnVuY3Rpb24gZ2V0RXJyb3JNc2coKSB7XG5cdCAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuX2Zvcm1zeUV4RXJyb3JNc2dzLmxlbmd0aCA9PT0gMSA/IHRoaXMuc3RhdGUuX2Zvcm1zeUV4RXJyb3JNc2dzWzBdIDogdGhpcy5zdGF0ZS5fZm9ybXN5RXhFcnJvck1zZ3M7XG5cdCAgICB9LFxuXHQgICAgZ2V0VmFsaWRhdG9yczogZnVuY3Rpb24gZ2V0VmFsaWRhdG9ycygpIHtcblx0ICAgICAgICB2YXIgcHJvcGVydHlWYWxpZGF0b3IgPSB0aGlzLnZhbGlkYXRvcnMgJiYgdGhpcy52YWxpZGF0b3JzLmNhbGwgPyBbdGhpcy52YWxpZGF0b3JzXSA6IHRoaXMudmFsaWRhdG9ycyB8fCBbXSxcblx0ICAgICAgICAgICAgdmFsaWRhdG9ycyA9IHByb3BlcnR5VmFsaWRhdG9yLmNvbmNhdCh0aGlzLnByb3BzLnZhbGlkYXRvcnMgfHwgW10pO1xuXHQgICAgICAgIHJldHVybiB2YWxpZGF0b3JzO1xuXHQgICAgfVxuXHR9O1xuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoZXhwb3J0cywgKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSgpKSkpXG5cbi8qKiovIH0sXG4vKiAzICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnO1xuXHRcblx0dmFyIFJlYWN0ID0gZ2xvYmFsLlJlYWN0IHx8IF9fd2VicGFja19yZXF1aXJlX18oMSksXG5cdCAgICBfID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTtcblx0bW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4ge1xuXHQgICAgICAgIGlzRm9ybTogdHJ1ZSxcblx0ICAgICAgICByZWdpc3RlcjogZnVuY3Rpb24gcmVnaXN0ZXIoY2hpbGQpIHtcblx0ICAgICAgICAgICAgdGhpcy5pbnB1dHMgPSB0aGlzLmlucHV0cyB8fCB7fTtcblx0ICAgICAgICAgICAgdGhpcy5jaGlsZElkID0gdGhpcy5jaGlsZElkIHx8IDA7XG5cdCAgICAgICAgICAgIGNoaWxkLnJlZ0lkID0gY2hpbGQucHJvcHMubmFtZSB8fCB0aGlzLmNoaWxkSWQrKztcblx0ICAgICAgICAgICAgdGhpcy5pbnB1dHNbY2hpbGQucmVnSWRdID0gY2hpbGQ7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICB1bnJlZ2lzdGVyOiBmdW5jdGlvbiB1bnJlZ2lzdGVyKGNoaWxkKSB7XG5cdCAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmlucHV0c1tjaGlsZC5yZWdJZF07XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBzdWJtaXQ6IGZ1bmN0aW9uIHN1Ym1pdChldmVudCkge1xuXHQgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKSB8fCBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHQgICAgICAgICAgICB2YXIgZmlyc3RFcnJvckNvbXBvbmVudCA9IHVuZGVmaW5lZDtcblx0ICAgICAgICAgICAgXy5lYWNoKHRoaXMuaW5wdXRzLCBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG5cdCAgICAgICAgICAgICAgICB2YXIgcmVzID0gY29tcG9uZW50LnZhbGlkYXRlKCk7XG5cdCAgICAgICAgICAgICAgICBmaXJzdEVycm9yQ29tcG9uZW50ID0gZmlyc3RFcnJvckNvbXBvbmVudCA9PT0gdW5kZWZpbmVkICYmIHJlcyA9PT0gZmFsc2UgPyBjb21wb25lbnQgOiBmaXJzdEVycm9yQ29tcG9uZW50O1xuXHQgICAgICAgICAgICB9KTtcblx0ICAgICAgICAgICAgZmlyc3RFcnJvckNvbXBvbmVudCA9PT0gdW5kZWZpbmVkID8gdGhpcy5wcm9wcy5vblN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogZmlyc3RFcnJvckNvbXBvbmVudC5mb2N1cyAmJiBmaXJzdEVycm9yQ29tcG9uZW50LmZvY3VzKCk7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcblx0ICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nLCB7IG9uU3VibWl0OiB0aGlzLnN1Ym1pdCwgc3R5bGU6IHRoaXMucHJvcHMuc3R5bGUsIGNsYXNzTmFtZTogdGhpcy5wcm9wcy5jbGFzc05hbWUgfSwgdGhpcy5wcm9wcy5jaGlsZHJlbik7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblx0fTtcblx0LyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKGV4cG9ydHMsIChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0oKSkpKVxuXG4vKioqLyB9LFxuLyogNCAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0bW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzRfXztcblxuLyoqKi8gfSxcbi8qIDUgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7XG5cdHZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7IGRpc3BsYXlOYW1lOiAnbW9kdWxlLmV4cG9ydHMnLFxuXHQgICAgbWl4aW5zOiBbX193ZWJwYWNrX3JlcXVpcmVfXygyKV0sXG5cdCAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcblx0ICAgICAgICB2YXIgZXJyb3JNc2cgPSB0aGlzLmdldEVycm9yTXNnKCk7XG5cdCAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgc3R5bGU6IHRoaXMucHJvcHMuc3R5bGUgfSwgdGhpcy5wcm9wcy5jaGlsZHJlbiwgUmVhY3QuY3JlYXRlRWxlbWVudCgnbGFiZWwnLCB7IHN0eWxlOiB7IGNvbG9yOiAncmVkJyB9IH0sIGVycm9yTXNnLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHsgcmVmOiAnZm9jdXMnLCBzdHlsZTogeyBvcGFjaXR5OiAnMCcgfSB9KSkpO1xuXHQgICAgfVxuXHR9KTtcblx0LyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKGV4cG9ydHMsIChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0oKSkpKVxuXG4vKioqLyB9LFxuLyogNiAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0LyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0Jztcblx0dmFyIFJlYWN0ID0gZ2xvYmFsLlJlYWN0IHx8IF9fd2VicGFja19yZXF1aXJlX18oMSksXG5cdCAgICBmb3JtID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKSgpO1xuXHRcblx0Zm9ybVsnbWl4aW5zJ10gPSBbX193ZWJwYWNrX3JlcXVpcmVfXygyKV07XG5cdG1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3MoZm9ybSk7XG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChleHBvcnRzLCAoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KCkpKSlcblxuLyoqKi8gfVxuLyoqKioqKi8gXSlcbn0pO1xuO1xuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIGZvcm1zeUV4LXJlYWN0LmpzXG4gKiovIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG5cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGV4cG9ydHM6IHt9LFxuIFx0XHRcdGlkOiBtb2R1bGVJZCxcbiBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiB3ZWJwYWNrL2Jvb3RzdHJhcCBmMjVmNWIyZWExYzNhOWZhZmEzZlxuICoqLyIsInZhciBGb3Jtc3lFeCA9IHt9LFxuICAgIEZvcm0gPSByZXF1aXJlKCcuL0Zvcm0uanN4JyksXG4gICAgQmxvY2sgPSByZXF1aXJlKCcuL0Jsb2NrLmpzeCcpLFxuICAgIE1peGluID0gcmVxdWlyZSgnLi9NaXhpbi5qcycpO1xuXG5Gb3Jtc3lFeC5NaXhpbiA9IE1peGluO1xuRm9ybXN5RXguRm9ybSA9IEZvcm07XG5Gb3Jtc3lFeC5CbG9jayA9IEJsb2NrO1xuXG5pZiAoIWdsb2JhbC5leHBvcnRzICYmICFnbG9iYWwubW9kdWxlICYmICghZ2xvYmFsLmRlZmluZSB8fCAhZ2xvYmFsLmRlZmluZS5hbWQpKSB7XG4gIGdsb2JhbC5Gb3Jtc3lFeCA9IEZvcm1zeUV4O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZvcm1zeUV4O1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9saWIvbWFpbi5qc1xuICoqLyIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX187XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiBleHRlcm5hbCBcInJlYWN0XCJcbiAqKiBtb2R1bGUgaWQgPSAxXG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCJ2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgcmVxdWlyZSgncmVhY3QnKSxcbiAgICBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpLFxuICAgIHJlZ0Zvcm1zID0ge30sXG4gICAgbW9ja0Zvcm0gPSByZXF1aXJlKCcuL2Zvcm0nKSxcbiAgICBkZWZhdWx0Rm9ybSA9ICdfREVGQVVMVF9GT1JNJztcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgZm9jdXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gaWYgKCF0aGlzLnJlZnMuZm9jdXMpIHtcbiAgICAgICAgLy8gICAgdGhyb3cgbmV3IEVycm9yKCdzaG91bGQgaGF2ZSBhIGNoaWxkIGNvbXBvbmVudCB3aXRoIHJlZiBuYW1lIGBpbnB1dGAsIG1vc3Qgb2YgdGhlIGNhc2UgcmVmIGlzIHNldCBvbiBFcnJvck1zZ0xhYmVsJyk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgUmVhY3QuZmluZERPTU5vZGUodGhpcy5yZWZzLmZvY3VzKSAmJlxuICAgICAgICAgICAgUmVhY3QuZmluZERPTU5vZGUodGhpcy5yZWZzLmZvY3VzKS5mb2N1cygpO1xuICAgIH0sXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfZm9ybXN5RXhWYWx1ZTogJycsXG4gICAgICAgICAgICBfZm9ybXN5RXhFcnJvck1zZ3M6IFtdXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBjb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXM7XG4gICAgICAgIGlmIChjb21wb25lbnQuaXNJbml0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb21wb25lbnQuaXNGb3JtKSB7IC8vIGZvcm1cbiAgICAgICAgICAgIC8vIGZvcm0gb2JqZWN0XG4gICAgICAgICAgICB2YXIgZm9ybU5hbWUgPSBjb21wb25lbnQucHJvcHMubmFtZSA/IGNvbXBvbmVudC5wcm9wcy5uYW1lIDogZGVmYXVsdEZvcm07XG4gICAgICAgICAgICBpZiAocmVnRm9ybXNbZm9ybU5hbWVdKSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmlucHV0cyA9IHJlZ0Zvcm1zW2Zvcm1OYW1lXS5pbnB1dHM7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNoaWxkSWQgPSByZWdGb3Jtc1tmb3JtTmFtZV0uY2hpbGRJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZ0Zvcm1zW2Zvcm1OYW1lXSA9IGNvbXBvbmVudDtcbiAgICAgICAgICAgIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goXG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wcm9wcy5yZWdGb3JtICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnByb3BzLnJlZ0Zvcm0gIT09IGZvcm1OYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29tcG9uZW50cyBhcmUgcmVnaXN0ZXJlZCB0byBhbm90aGVyIGZvcm1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50LnJlZ2lzdGVyKGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQuaXNJbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgeyAvLyBlbGVtZW50cyBpbiBmb3JtXG4gICAgICAgICAgICB2YXIgcmVnVG9Gb3JtTmFtZTtcbiAgICAgICAgICAgIC8vIGlmICghdGhpcy52YWxpZGF0b3IgfHwgIXRoaXMudmFsaWRhdG9yLmNhbGwpIHtcbiAgICAgICAgICAgIC8vICAgIHRocm93IG5ldyBFcnJvcignc2hvdWxkIGltcGxlbWVudCBgZm9jdXNgIGFuZCBgdmFsaWRhdG9yYCBmdW5jdGlvbicpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgcmVnVG9Gb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtID8gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gOiBkZWZhdWx0Rm9ybTtcbiAgICAgICAgICAgIGlmIChyZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0gPSBtb2NrRm9ybSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0ucmVnaXN0ZXIoY29tcG9uZW50KTtcbiAgICAgICAgfVxuICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gdHJ1ZTtcbiAgICB9LFxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb21wb25lbnQgPSB0aGlzO1xuICAgICAgICBpZiAoIWNvbXBvbmVudC5pc0luaXQpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbXBvbmVudC5pc0Zvcm0pIHsgLy8gZm9ybVxuICAgICAgICAgICAgLy8gZm9ybSBvYmplY3RcbiAgICAgICAgICAgIHZhciBmb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5uYW1lID8gY29tcG9uZW50LnByb3BzLm5hbWUgOiBkZWZhdWx0Rm9ybTtcbiAgICAgICAgICAgIGRlbGV0ZSByZWdGb3Jtc1tmb3JtTmFtZV07XG4gICAgICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7IC8vIGVsZW1lbnRzIGluIGZvcm1cbiAgICAgICAgICAgIHZhciByZWdUb0Zvcm1OYW1lID0gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gPyBjb21wb25lbnQucHJvcHMucmVnRm9ybSA6IGRlZmF1bHRGb3JtO1xuICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0gPyAocmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0udW5yZWdpc3Rlcihjb21wb25lbnQpKSA6IHVuZGVmaW5lZCA7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdmFyIF92YWx1ZSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHRoaXMuc3RhdGUuX2Zvcm1WYWx1ZSxcbiAgICAgICAgICAgIHZhbGlkYXRvcnMgPSB0aGlzLmdldFZhbGlkYXRvcnMoKSxcbiAgICAgICAgICAgIGZvcm1zeUV4RXJyb3JNc2dzLFxuICAgICAgICAgICAgaXNDb250aW51ZSA9IHRydWUsXG4gICAgICAgICAgICByZXM7XG4gICAgICAgIHZhbGlkYXRvcnMgJiZcbiAgICAgICAgICAgIChmb3Jtc3lFeEVycm9yTXNncyA9IF8ubWFwKHZhbGlkYXRvcnMsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb250aW51ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXMgPSB2YWxpZGF0b3IoX3ZhbHVlKSB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5jb250aW51ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29udGludWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzLnJlcyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMubXNnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApKTtcbiAgICAgICAgZm9ybXN5RXhFcnJvck1zZ3MgPSBfLmZpbHRlcihcbiAgICAgICAgICAgIGZvcm1zeUV4RXJyb3JNc2dzLFxuICAgICAgICAgICAgZnVuY3Rpb24gKGZvcm1zeUV4RXJyb3JNc2cpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZSAmJiBmb3Jtc3lFeEVycm9yTXNnO1xuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgX2Zvcm1WYWx1ZTogX3ZhbHVlLFxuICAgICAgICAgICAgICAgIF9mb3Jtc3lFeEVycm9yTXNnczogZm9ybXN5RXhFcnJvck1zZ3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGZvcm1zeUV4RXJyb3JNc2dzLmxlbmd0aCA9PT0gMDtcbiAgICB9LFxuICAgIGdldFZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLl9mb3JtVmFsdWU7XG4gICAgfSxcbiAgICBnZXRFcnJvck1zZzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5fZm9ybXN5RXhFcnJvck1zZ3MubGVuZ3RoID09PSAxID9cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLl9mb3Jtc3lFeEVycm9yTXNnc1swXSA6IHRoaXMuc3RhdGUuX2Zvcm1zeUV4RXJyb3JNc2dzO1xuICAgIH0sXG4gICAgZ2V0VmFsaWRhdG9yczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcHJvcGVydHlWYWxpZGF0b3IgPSAgdGhpcy52YWxpZGF0b3JzICYmIHRoaXMudmFsaWRhdG9ycy5jYWxsID9cbiAgICAgICAgICAgIFt0aGlzLnZhbGlkYXRvcnNdIDpcbiAgICAgICAgICAgICh0aGlzLnZhbGlkYXRvcnMgfHwgW10pLFxuICAgICAgICAgICAgdmFsaWRhdG9ycyA9IHByb3BlcnR5VmFsaWRhdG9yLmNvbmNhdCh0aGlzLnByb3BzLnZhbGlkYXRvcnMgfHwgW10pO1xuICAgICAgICByZXR1cm4gdmFsaWRhdG9ycztcbiAgICB9XG59XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL2xpYi9NaXhpbi5qc1xuICoqLyIsInZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCByZXF1aXJlKCdyZWFjdCcpLFxuICAgIF8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpc0Zvcm06IHRydWUsXG4gICAgICAgIHJlZ2lzdGVyOiBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzID0gdGhpcy5pbnB1dHMgfHwge307XG4gICAgICAgICAgICB0aGlzLmNoaWxkSWQgPSB0aGlzLmNoaWxkSWQgfHwgMDtcbiAgICAgICAgICAgIGNoaWxkLnJlZ0lkID0gY2hpbGQucHJvcHMubmFtZSB8fCB0aGlzLmNoaWxkSWQrKztcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzW2NoaWxkLnJlZ0lkXSA9IGNoaWxkO1xuICAgICAgICB9LFxuICAgICAgICB1bnJlZ2lzdGVyOiBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmlucHV0c1tjaGlsZC5yZWdJZF07XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKSB8fCBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIGZpcnN0RXJyb3JDb21wb25lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dHMsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSBjb21wb25lbnQudmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0RXJyb3JDb21wb25lbnQgPSAoZmlyc3RFcnJvckNvbXBvbmVudCA9PT0gdW5kZWZpbmVkICYmIHJlcyA9PT0gZmFsc2UpID8gY29tcG9uZW50OiBmaXJzdEVycm9yQ29tcG9uZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGZpcnN0RXJyb3JDb21wb25lbnQgPT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vblN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDpcbiAgICAgICAgICAgICAgICBmaXJzdEVycm9yQ29tcG9uZW50LmZvY3VzICYmIGZpcnN0RXJyb3JDb21wb25lbnQuZm9jdXMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudCgnZm9ybScsXG4gICAgICAgICAgICAgICAge29uU3VibWl0OiB0aGlzLnN1Ym1pdCwgc3R5bGU6IHRoaXMucHJvcHMuc3R5bGUsIGNsYXNzTmFtZTogdGhpcy5wcm9wcy5jbGFzc05hbWV9LFxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuY2hpbGRyZW5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9O1xufTtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vbGliL2Zvcm0uanNcbiAqKi8iLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNF9fO1xuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogZXh0ZXJuYWwgXCJ1bmRlcnNjb3JlXCJcbiAqKiBtb2R1bGUgaWQgPSA0XG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCIndXNlIHN0cmljdCc7XG52YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgcmVxdWlyZSgncmVhY3QnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6IFwibW9kdWxlLmV4cG9ydHNcIixcbiAgICBtaXhpbnM6IFtcbiAgICAgICByZXF1aXJlKCcuL01peGluJylcbiAgICBdLFxuICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXJyb3JNc2cgPSB0aGlzLmdldEVycm9yTXNnKCk7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtzdHlsZTogdGhpcy5wcm9wcy5zdHlsZX0sIFxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuY2hpbGRyZW4sIFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiLCB7c3R5bGU6IHtjb2xvcjogJ3JlZCd9fSwgZXJyb3JNc2csIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7cmVmOiBcImZvY3VzXCIsIHN0eWxlOiB7b3BhY2l0eTogJzAnfX0pKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cbn0pO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9saWIvQmxvY2suanN4XG4gKiovIiwiJ3VzZSBzdHJpY3QnO1xudmFyIFJlYWN0ID0gZ2xvYmFsLlJlYWN0IHx8IHJlcXVpcmUoJ3JlYWN0JyksXG4gICAgZm9ybSA9IHJlcXVpcmUoJy4vZm9ybScpKCk7XG5cbmZvcm1bJ21peGlucyddID0gW3JlcXVpcmUoJy4vTWl4aW4nKV07XG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKGZvcm0pO1xuXG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL2xpYi9Gb3JtLmpzeFxuICoqLyJdLCJzb3VyY2VSb290IjoiIn0=