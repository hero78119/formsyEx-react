!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("react"),require("underscore")):"function"==typeof define&&define.amd?define(["react","underscore"],r):"object"==typeof exports?exports.FormsyEx=r(require("react"),require("underscore")):t.FormsyEx=r(t.react,t.underscore)}(this,function(t,r){return function(t){function r(s){if(e[s])return e[s].exports;var i=e[s]={exports:{},id:s,loaded:!1};return t[s].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r,e){(function(r){"use strict";var s=(r.React||e(1),{}),i=e(6),o=e(5),n=e(2);s.Mixin=n,s.Form=i,s.Block=o,r.exports||r.module||r.define&&r.define.amd||(r.FormsyEx=s),t.exports=s}).call(r,function(){return this}())},function(r,e){r.exports=t},function(t,r,e){(function(r){"use strict";var s=r.React||e(1),i=e(4),o={},n=e(3),u="_DEFAULT_FORM";t.exports={focus:function(){s.findDOMNode(this.refs.focus)&&s.findDOMNode(this.refs.focus).focus()},getInitialState:function(){return{_formsyExValue:"",_formsyExErrorMsgs:[]}},componentWillMount:function(){var t=this;if(t.isInit===!0)return void 0;if(t.isForm){var r=t.props.name?t.props.name:u;o[r]&&(t.inputs=o[r].inputs,t.childId=o[r].childId),o[r]=t,s.Children.forEach(t.children,function(e){return void 0!==e.props.regForm&&e.props.regForm!==r?void 0:(t.register(e),void(e.isInit=!0))})}else{var e;e=t.props.regForm?t.props.regForm:u,void 0===o[e]&&(o[e]=n()),o[e].register(t)}t.isInit=!0},componentWillUnmount:function(){var t=this;if(!t.isInit)return void 0;if(t.isForm){var r=t.props.name?t.props.name:u;delete o[r],t.isInit=!1}else{var e=t.props.regForm?t.props.regForm:u;o[e]?o[e].unregister(t):void 0}},validate:function(t){var r,e,s=void 0!==t?t:this.state._formValue,o=this.getValidators(),n=!0;return o&&(r=i.map(o,function(t){return n===!1?"":(e=t(s)||{},e["continue"]===!1&&(n=!1),e.res===!1?e.msg:"")})),r=i.filter(r,function(t){return!0&&t}),this.setState({_formValue:s,_formsyExErrorMsgs:r}),0===r.length},getValue:function(){return this.state._formValue},getErrorMsg:function(){return 1===this.state._formsyExErrorMsgs.length?this.state._formsyExErrorMsgs[0]:this.state._formsyExErrorMsgs},getValidators:function(){var t=this.validators&&this.validators.call?[this.validators]:this.validators||[],r=t.concat(this.props.validators||[]);return r}}}).call(r,function(){return this}())},function(t,r,e){(function(r){"use strict";var s=r.React||e(1),i=e(4);t.exports=function(){return{isForm:!0,register:function(t){this.inputs=this.inputs||{},this.childId=this.childId||0,t.regId=t.props.name||this.childId++,this.inputs[t.regId]=t},unregister:function(t){delete this.inputs[t.regId]},submit:function(t){t.stopPropagation()||t.preventDefault();var r=void 0;i.each(this.inputs,function(t){var e=t.validate();r=void 0===r&&e===!1?t:r}),void 0===r?this.props.onSubmit.apply(this,arguments):r.focus&&r.focus()},render:function(){return s.createElement("form",{onSubmit:this.submit,style:this.props.style,className:this.props.className},this.props.children)}}}}).call(r,function(){return this}())},function(t,e){t.exports=r},function(t,r,e){(function(r){"use strict";var s=r.React||e(1);t.exports=s.createClass({displayName:"module.exports",mixins:[e(2)],render:function(){var t=this.getErrorMsg();return s.createElement("div",{style:this.props.style},this.props.children,s.createElement("label",{style:{color:"red"}},t,s.createElement("input",{ref:"focus",style:{opacity:"0"}})))}})}).call(r,function(){return this}())},function(t,r,e){(function(r){"use strict";var s=r.React||e(1),i=e(3)();i.mixins=[e(2)],t.exports=s.createClass(i)}).call(r,function(){return this}())}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy9mb3Jtc3lFeC1yZWFjdC5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgZWFhNmE2MjI0NjMzNDUwMDE1MDIiLCJ3ZWJwYWNrOi8vLy4vbGliL21haW4uanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwicmVhY3RcIiIsIndlYnBhY2s6Ly8vLi9saWIvTWl4aW4uanMiLCJ3ZWJwYWNrOi8vLy4vbGliL2Zvcm0uanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwidW5kZXJzY29yZVwiIiwid2VicGFjazovLy8uL2xpYi9CbG9jay5qc3giLCJ3ZWJwYWNrOi8vLy4vbGliL0Zvcm0uanN4Il0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX18iLCJfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzRfXyIsIm1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpbnN0YWxsZWRNb2R1bGVzIiwiaWQiLCJsb2FkZWQiLCJjYWxsIiwibSIsImMiLCJwIiwiZ2xvYmFsIiwiRm9ybXN5RXgiLCJSZWFjdCIsIkZvcm0iLCJCbG9jayIsIk1peGluIiwiXyIsInJlZ0Zvcm1zIiwibW9ja0Zvcm0iLCJkZWZhdWx0Rm9ybSIsImZvY3VzIiwiZmluZERPTU5vZGUiLCJyZWZzIiwiZ2V0SW5pdGlhbFN0YXRlIiwiX2Zvcm1zeUV4VmFsdWUiLCJfZm9ybXN5RXhFcnJvck1zZ3MiLCJjb21wb25lbnRXaWxsTW91bnQiLCJjb21wb25lbnQiLCJpc0luaXQiLCJ1bmRlZmluZWQiLCJpc0Zvcm0iLCJmb3JtTmFtZSIsInByb3BzIiwibmFtZSIsImlucHV0cyIsImNoaWxkSWQiLCJDaGlsZHJlbiIsImZvckVhY2giLCJjaGlsZHJlbiIsImNoaWxkIiwicmVnRm9ybSIsInJlZ2lzdGVyIiwicmVnVG9Gb3JtTmFtZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwidW5yZWdpc3RlciIsInZhbGlkYXRlIiwidmFsdWUiLCJmb3Jtc3lFeEVycm9yTXNncyIsInJlcyIsIl92YWx1ZSIsInN0YXRlIiwiX2Zvcm1WYWx1ZSIsInZhbGlkYXRvcnMiLCJnZXRWYWxpZGF0b3JzIiwiaXNDb250aW51ZSIsIm1hcCIsInZhbGlkYXRvciIsIm1zZyIsImZpbHRlciIsImZvcm1zeUV4RXJyb3JNc2ciLCJzZXRTdGF0ZSIsImxlbmd0aCIsImdldFZhbHVlIiwiZ2V0RXJyb3JNc2ciLCJwcm9wZXJ0eVZhbGlkYXRvciIsImNvbmNhdCIsInJlZ0lkIiwic3VibWl0IiwiZXZlbnQiLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImZpcnN0RXJyb3JDb21wb25lbnQiLCJlYWNoIiwib25TdWJtaXQiLCJhcHBseSIsImFyZ3VtZW50cyIsInJlbmRlciIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImNsYXNzTmFtZSIsImNyZWF0ZUNsYXNzIiwiZGlzcGxheU5hbWUiLCJtaXhpbnMiLCJlcnJvck1zZyIsImNvbG9yIiwicmVmIiwib3BhY2l0eSIsImZvcm0iXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsZ0JBQUFDLFVBQUEsZ0JBQUFDLFFBQ0FBLE9BQUFELFFBQUFELEVBQUFHLFFBQUEsU0FBQUEsUUFBQSxlQUNBLGtCQUFBQyxnQkFBQUMsSUFDQUQsUUFBQSxzQkFBQUosR0FDQSxnQkFBQUMsU0FDQUEsUUFBQSxTQUFBRCxFQUFBRyxRQUFBLFNBQUFBLFFBQUEsZUFFQUosRUFBQSxTQUFBQyxFQUFBRCxFQUFBLE1BQUFBLEVBQUEsYUFDQ08sS0FBQSxTQUFBQyxFQUFBQyxHQUNELE1DQWdCLFVBQVVDLEdDTjFCLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsRUFBQUQsR0FDQSxNQUFBQyxHQUFBRCxHQUFB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LEdBQ2hDc0YsRUFBT3RGLEVBQVEsSUFFbkJzRixHQUFhLFFBQUt0RixFQUFRLElBQzFCUixFQUFPRCxRQUFVb0IsRUFBTW9FLFlBQVlPLEtSNFFMakYsS0FBS2QsRUFBVSxXQUFhLE1BQU9LIiwiZmlsZSI6ImZvcm1zeUV4LXJlYWN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwicmVhY3RcIiksIHJlcXVpcmUoXCJ1bmRlcnNjb3JlXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtcInJlYWN0XCIsIFwidW5kZXJzY29yZVwiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJGb3Jtc3lFeFwiXSA9IGZhY3RvcnkocmVxdWlyZShcInJlYWN0XCIpLCByZXF1aXJlKFwidW5kZXJzY29yZVwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiRm9ybXN5RXhcIl0gPSBmYWN0b3J5KHJvb3RbXCJyZWFjdFwiXSwgcm9vdFtcInVuZGVyc2NvcmVcIl0pO1xufSkodGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNF9fKSB7XG5yZXR1cm4gXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uXG4gKiovIiwiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwicmVhY3RcIiksIHJlcXVpcmUoXCJ1bmRlcnNjb3JlXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtcInJlYWN0XCIsIFwidW5kZXJzY29yZVwiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJGb3Jtc3lFeFwiXSA9IGZhY3RvcnkocmVxdWlyZShcInJlYWN0XCIpLCByZXF1aXJlKFwidW5kZXJzY29yZVwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiRm9ybXN5RXhcIl0gPSBmYWN0b3J5KHJvb3RbXCJyZWFjdFwiXSwgcm9vdFtcInVuZGVyc2NvcmVcIl0pO1xufSkodGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNF9fKSB7XG5yZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcFxuLyoqKioqKi8gXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge30sXG4vKioqKioqLyBcdFx0XHRpZDogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG4vKioqKioqLyB9KVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKioqKiovIChbXG4vKiAwICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnO1xuXHRcblx0dmFyIFJlYWN0ID0gZ2xvYmFsLlJlYWN0IHx8IF9fd2VicGFja19yZXF1aXJlX18oMSksXG5cdCAgICBGb3Jtc3lFeCA9IHt9LFxuXHQgICAgRm9ybSA9IF9fd2VicGFja19yZXF1aXJlX18oNiksXG5cdCAgICBCbG9jayA9IF9fd2VicGFja19yZXF1aXJlX18oNSksXG5cdCAgICBNaXhpbiA9IF9fd2VicGFja19yZXF1aXJlX18oMik7XG5cdFxuXHRGb3Jtc3lFeC5NaXhpbiA9IE1peGluO1xuXHRGb3Jtc3lFeC5Gb3JtID0gRm9ybTtcblx0Rm9ybXN5RXguQmxvY2sgPSBCbG9jaztcblx0XG5cdGlmICghZ2xvYmFsLmV4cG9ydHMgJiYgIWdsb2JhbC5tb2R1bGUgJiYgKCFnbG9iYWwuZGVmaW5lIHx8ICFnbG9iYWwuZGVmaW5lLmFtZCkpIHtcblx0ICAgIGdsb2JhbC5Gb3Jtc3lFeCA9IEZvcm1zeUV4O1xuXHR9XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IEZvcm1zeUV4O1xuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoZXhwb3J0cywgKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSgpKSkpXG5cbi8qKiovIH0sXG4vKiAxICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfMV9fO1xuXG4vKioqLyB9LFxuLyogMiAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0LyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0Jztcblx0XG5cdHZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpLFxuXHQgICAgXyA9IF9fd2VicGFja19yZXF1aXJlX18oNCksXG5cdCAgICByZWdGb3JtcyA9IHt9LFxuXHQgICAgbW9ja0Zvcm0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpLFxuXHQgICAgZGVmYXVsdEZvcm0gPSAnX0RFRkFVTFRfRk9STSc7XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IHtcblx0ICAgIGZvY3VzOiBmdW5jdGlvbiBmb2N1cygpIHtcblx0ICAgICAgICAvLyBpZiAoIXRoaXMucmVmcy5mb2N1cykge1xuXHQgICAgICAgIC8vICAgIHRocm93IG5ldyBFcnJvcignc2hvdWxkIGhhdmUgYSBjaGlsZCBjb21wb25lbnQgd2l0aCByZWYgbmFtZSBgaW5wdXRgLCBtb3N0IG9mIHRoZSBjYXNlIHJlZiBpcyBzZXQgb24gRXJyb3JNc2dMYWJlbCcpO1xuXHQgICAgICAgIC8vIH1cblx0ICAgICAgICBSZWFjdC5maW5kRE9NTm9kZSh0aGlzLnJlZnMuZm9jdXMpICYmIFJlYWN0LmZpbmRET01Ob2RlKHRoaXMucmVmcy5mb2N1cykuZm9jdXMoKTtcblx0ICAgIH0sXG5cdCAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcblx0ICAgICAgICByZXR1cm4ge1xuXHQgICAgICAgICAgICBfZm9ybXN5RXhWYWx1ZTogJycsXG5cdCAgICAgICAgICAgIF9mb3Jtc3lFeEVycm9yTXNnczogW11cblx0ICAgICAgICB9O1xuXHQgICAgfSxcblx0ICAgIGNvbXBvbmVudFdpbGxNb3VudDogZnVuY3Rpb24gY29tcG9uZW50V2lsbE1vdW50KCkge1xuXHQgICAgICAgIHZhciBjb21wb25lbnQgPSB0aGlzO1xuXHQgICAgICAgIGlmIChjb21wb25lbnQuaXNJbml0ID09PSB0cnVlKSB7XG5cdCAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGlmIChjb21wb25lbnQuaXNGb3JtKSB7XG5cdCAgICAgICAgICAgIC8vIGZvcm1cblx0ICAgICAgICAgICAgLy8gZm9ybSBvYmplY3Rcblx0ICAgICAgICAgICAgdmFyIGZvcm1OYW1lID0gY29tcG9uZW50LnByb3BzLm5hbWUgPyBjb21wb25lbnQucHJvcHMubmFtZSA6IGRlZmF1bHRGb3JtO1xuXHQgICAgICAgICAgICBpZiAocmVnRm9ybXNbZm9ybU5hbWVdKSB7XG5cdCAgICAgICAgICAgICAgICBjb21wb25lbnQuaW5wdXRzID0gcmVnRm9ybXNbZm9ybU5hbWVdLmlucHV0cztcblx0ICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jaGlsZElkID0gcmVnRm9ybXNbZm9ybU5hbWVdLmNoaWxkSWQ7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgcmVnRm9ybXNbZm9ybU5hbWVdID0gY29tcG9uZW50O1xuXHQgICAgICAgICAgICBSZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNvbXBvbmVudC5jaGlsZHJlbiwgZnVuY3Rpb24gKGNoaWxkKSB7XG5cdCAgICAgICAgICAgICAgICBpZiAoY2hpbGQucHJvcHMucmVnRm9ybSAhPT0gdW5kZWZpbmVkICYmIGNoaWxkLnByb3BzLnJlZ0Zvcm0gIT09IGZvcm1OYW1lKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgLy8gY29tcG9uZW50cyBhcmUgcmVnaXN0ZXJlZCB0byBhbm90aGVyIGZvcm1cblx0ICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXHQgICAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICAgICAgY29tcG9uZW50LnJlZ2lzdGVyKGNoaWxkKTtcblx0ICAgICAgICAgICAgICAgIGNoaWxkLmlzSW5pdCA9IHRydWU7XG5cdCAgICAgICAgICAgIH0pO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgIC8vIGVsZW1lbnRzIGluIGZvcm1cblx0ICAgICAgICAgICAgdmFyIHJlZ1RvRm9ybU5hbWU7XG5cdCAgICAgICAgICAgIC8vIGlmICghdGhpcy52YWxpZGF0b3IgfHwgIXRoaXMudmFsaWRhdG9yLmNhbGwpIHtcblx0ICAgICAgICAgICAgLy8gICAgdGhyb3cgbmV3IEVycm9yKCdzaG91bGQgaW1wbGVtZW50IGBmb2N1c2AgYW5kIGB2YWxpZGF0b3JgIGZ1bmN0aW9uJyk7XG5cdCAgICAgICAgICAgIC8vIH1cblx0ICAgICAgICAgICAgcmVnVG9Gb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtID8gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gOiBkZWZhdWx0Rm9ybTtcblx0ICAgICAgICAgICAgaWYgKHJlZ0Zvcm1zW3JlZ1RvRm9ybU5hbWVdID09PSB1bmRlZmluZWQpIHtcblx0ICAgICAgICAgICAgICAgIHJlZ0Zvcm1zW3JlZ1RvRm9ybU5hbWVdID0gbW9ja0Zvcm0oKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICByZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXS5yZWdpc3Rlcihjb21wb25lbnQpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gdHJ1ZTtcblx0ICAgIH0sXG5cdCAgICBjb21wb25lbnRXaWxsVW5tb3VudDogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG5cdCAgICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXM7XG5cdCAgICAgICAgaWYgKCFjb21wb25lbnQuaXNJbml0KSB7XG5cdCAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGlmIChjb21wb25lbnQuaXNGb3JtKSB7XG5cdCAgICAgICAgICAgIC8vIGZvcm1cblx0ICAgICAgICAgICAgLy8gZm9ybSBvYmplY3Rcblx0ICAgICAgICAgICAgdmFyIGZvcm1OYW1lID0gY29tcG9uZW50LnByb3BzLm5hbWUgPyBjb21wb25lbnQucHJvcHMubmFtZSA6IGRlZmF1bHRGb3JtO1xuXHQgICAgICAgICAgICBkZWxldGUgcmVnRm9ybXNbZm9ybU5hbWVdO1xuXHQgICAgICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gZmFsc2U7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgLy8gZWxlbWVudHMgaW4gZm9ybVxuXHQgICAgICAgICAgICB2YXIgcmVnVG9Gb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtID8gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gOiBkZWZhdWx0Rm9ybTtcblx0ICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0gPyByZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXS51bnJlZ2lzdGVyKGNvbXBvbmVudCkgOiB1bmRlZmluZWQ7XG5cdCAgICAgICAgfVxuXHQgICAgfSxcblx0ICAgIHZhbGlkYXRlOiBmdW5jdGlvbiB2YWxpZGF0ZSh2YWx1ZSkge1xuXHQgICAgICAgIHZhciBfdmFsdWUgPSB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiB0aGlzLnN0YXRlLl9mb3JtVmFsdWUsXG5cdCAgICAgICAgICAgIHZhbGlkYXRvcnMgPSB0aGlzLmdldFZhbGlkYXRvcnMoKSxcblx0ICAgICAgICAgICAgZm9ybXN5RXhFcnJvck1zZ3MsXG5cdCAgICAgICAgICAgIGlzQ29udGludWUgPSB0cnVlLFxuXHQgICAgICAgICAgICByZXM7XG5cdCAgICAgICAgdmFsaWRhdG9ycyAmJiAoZm9ybXN5RXhFcnJvck1zZ3MgPSBfLm1hcCh2YWxpZGF0b3JzLCBmdW5jdGlvbiAodmFsaWRhdG9yKSB7XG5cdCAgICAgICAgICAgIGlmIChpc0NvbnRpbnVlID09PSBmYWxzZSkge1xuXHQgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIHJlcyA9IHZhbGlkYXRvcihfdmFsdWUpIHx8IHt9O1xuXHQgICAgICAgICAgICBpZiAocmVzWydjb250aW51ZSddID09PSBmYWxzZSkge1xuXHQgICAgICAgICAgICAgICAgaXNDb250aW51ZSA9IGZhbHNlO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIGlmIChyZXMucmVzID09PSBmYWxzZSkge1xuXHQgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5tc2c7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgcmV0dXJuICcnO1xuXHQgICAgICAgIH0pKTtcblx0ICAgICAgICBmb3Jtc3lFeEVycm9yTXNncyA9IF8uZmlsdGVyKGZvcm1zeUV4RXJyb3JNc2dzLCBmdW5jdGlvbiAoZm9ybXN5RXhFcnJvck1zZykge1xuXHQgICAgICAgICAgICByZXR1cm4gdHJ1ZSAmJiBmb3Jtc3lFeEVycm9yTXNnO1xuXHQgICAgICAgIH0pO1xuXHQgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuXHQgICAgICAgICAgICBfZm9ybVZhbHVlOiBfdmFsdWUsXG5cdCAgICAgICAgICAgIF9mb3Jtc3lFeEVycm9yTXNnczogZm9ybXN5RXhFcnJvck1zZ3Ncblx0ICAgICAgICB9KTtcblx0ICAgICAgICByZXR1cm4gZm9ybXN5RXhFcnJvck1zZ3MubGVuZ3RoID09PSAwO1xuXHQgICAgfSxcblx0ICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcblx0ICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5fZm9ybVZhbHVlO1xuXHQgICAgfSxcblx0ICAgIGdldEVycm9yTXNnOiBmdW5jdGlvbiBnZXRFcnJvck1zZygpIHtcblx0ICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5fZm9ybXN5RXhFcnJvck1zZ3MubGVuZ3RoID09PSAxID8gdGhpcy5zdGF0ZS5fZm9ybXN5RXhFcnJvck1zZ3NbMF0gOiB0aGlzLnN0YXRlLl9mb3Jtc3lFeEVycm9yTXNncztcblx0ICAgIH0sXG5cdCAgICBnZXRWYWxpZGF0b3JzOiBmdW5jdGlvbiBnZXRWYWxpZGF0b3JzKCkge1xuXHQgICAgICAgIHZhciBwcm9wZXJ0eVZhbGlkYXRvciA9IHRoaXMudmFsaWRhdG9ycyAmJiB0aGlzLnZhbGlkYXRvcnMuY2FsbCA/IFt0aGlzLnZhbGlkYXRvcnNdIDogdGhpcy52YWxpZGF0b3JzIHx8IFtdLFxuXHQgICAgICAgICAgICB2YWxpZGF0b3JzID0gcHJvcGVydHlWYWxpZGF0b3IuY29uY2F0KHRoaXMucHJvcHMudmFsaWRhdG9ycyB8fCBbXSk7XG5cdCAgICAgICAgcmV0dXJuIHZhbGlkYXRvcnM7XG5cdCAgICB9XG5cdH07XG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChleHBvcnRzLCAoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KCkpKSlcblxuLyoqKi8gfSxcbi8qIDMgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgX193ZWJwYWNrX3JlcXVpcmVfXygxKSxcblx0ICAgIF8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpO1xuXHRtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiB7XG5cdCAgICAgICAgaXNGb3JtOiB0cnVlLFxuXHQgICAgICAgIHJlZ2lzdGVyOiBmdW5jdGlvbiByZWdpc3RlcihjaGlsZCkge1xuXHQgICAgICAgICAgICB0aGlzLmlucHV0cyA9IHRoaXMuaW5wdXRzIHx8IHt9O1xuXHQgICAgICAgICAgICB0aGlzLmNoaWxkSWQgPSB0aGlzLmNoaWxkSWQgfHwgMDtcblx0ICAgICAgICAgICAgY2hpbGQucmVnSWQgPSBjaGlsZC5wcm9wcy5uYW1lIHx8IHRoaXMuY2hpbGRJZCsrO1xuXHQgICAgICAgICAgICB0aGlzLmlucHV0c1tjaGlsZC5yZWdJZF0gPSBjaGlsZDtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHVucmVnaXN0ZXI6IGZ1bmN0aW9uIHVucmVnaXN0ZXIoY2hpbGQpIHtcblx0ICAgICAgICAgICAgZGVsZXRlIHRoaXMuaW5wdXRzW2NoaWxkLnJlZ0lkXTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gc3VibWl0KGV2ZW50KSB7XG5cdCAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpIHx8IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdCAgICAgICAgICAgIHZhciBmaXJzdEVycm9yQ29tcG9uZW50ID0gdW5kZWZpbmVkO1xuXHQgICAgICAgICAgICBfLmVhY2godGhpcy5pbnB1dHMsIGZ1bmN0aW9uIChjb21wb25lbnQpIHtcblx0ICAgICAgICAgICAgICAgIHZhciByZXMgPSBjb21wb25lbnQudmFsaWRhdGUoKTtcblx0ICAgICAgICAgICAgICAgIGZpcnN0RXJyb3JDb21wb25lbnQgPSBmaXJzdEVycm9yQ29tcG9uZW50ID09PSB1bmRlZmluZWQgJiYgcmVzID09PSBmYWxzZSA/IGNvbXBvbmVudCA6IGZpcnN0RXJyb3JDb21wb25lbnQ7XG5cdCAgICAgICAgICAgIH0pO1xuXHQgICAgICAgICAgICBmaXJzdEVycm9yQ29tcG9uZW50ID09PSB1bmRlZmluZWQgPyB0aGlzLnByb3BzLm9uU3VibWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBmaXJzdEVycm9yQ29tcG9uZW50LmZvY3VzICYmIGZpcnN0RXJyb3JDb21wb25lbnQuZm9jdXMoKTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuXHQgICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcblx0ICAgICAgICAgICAgICAgICdmb3JtJyxcblx0ICAgICAgICAgICAgICAgIHsgb25TdWJtaXQ6IHRoaXMuc3VibWl0LCBzdHlsZTogdGhpcy5wcm9wcy5zdHlsZSwgY2xhc3NOYW1lOiB0aGlzLnByb3BzLmNsYXNzTmFtZSB9LFxuXHQgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5jaGlsZHJlblxuXHQgICAgICAgICAgICApO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cdH07XG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChleHBvcnRzLCAoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KCkpKSlcblxuLyoqKi8gfSxcbi8qIDQgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdG1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV80X187XG5cbi8qKiovIH0sXG4vKiA1ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnO1xuXHR2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblx0XG5cdG1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3MoeyBkaXNwbGF5TmFtZTogJ21vZHVsZS5leHBvcnRzJyxcblx0ICAgIG1peGluczogW19fd2VicGFja19yZXF1aXJlX18oMildLFxuXHQgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG5cdCAgICAgICAgdmFyIGVycm9yTXNnID0gdGhpcy5nZXRFcnJvck1zZygpO1xuXHQgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IHN0eWxlOiB0aGlzLnByb3BzLnN0eWxlIH0sIHRoaXMucHJvcHMuY2hpbGRyZW4sIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJywgeyBzdHlsZTogeyBjb2xvcjogJ3JlZCcgfSB9LCBlcnJvck1zZywgUmVhY3QuY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7IHJlZjogJ2ZvY3VzJywgc3R5bGU6IHsgb3BhY2l0eTogJzAnIH0gfSkpKTtcblx0ICAgIH1cblx0fSk7XG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChleHBvcnRzLCAoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KCkpKSlcblxuLyoqKi8gfSxcbi8qIDYgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7XG5cdHZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpLFxuXHQgICAgZm9ybSA9IF9fd2VicGFja19yZXF1aXJlX18oMykoKTtcblx0XG5cdGZvcm1bJ21peGlucyddID0gW19fd2VicGFja19yZXF1aXJlX18oMildO1xuXHRtb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKGZvcm0pO1xuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoZXhwb3J0cywgKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSgpKSkpXG5cbi8qKiovIH1cbi8qKioqKiovIF0pXG59KTtcbjtcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiBmb3Jtc3lFeC1yZWFjdC5qc1xuICoqLyIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRleHBvcnRzOiB7fSxcbiBcdFx0XHRpZDogbW9kdWxlSWQsXG4gXHRcdFx0bG9hZGVkOiBmYWxzZVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogd2VicGFjay9ib290c3RyYXAgZWFhNmE2MjI0NjMzNDUwMDE1MDJcbiAqKi8iLCJ2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgcmVxdWlyZSgncmVhY3QnKSxcbiAgICBGb3Jtc3lFeCA9IHt9LFxuICAgIEZvcm0gPSByZXF1aXJlKCcuL0Zvcm0uanN4JyksXG4gICAgQmxvY2sgPSByZXF1aXJlKCcuL0Jsb2NrLmpzeCcpLFxuICAgIE1peGluID0gcmVxdWlyZSgnLi9NaXhpbi5qcycpO1xuXG5Gb3Jtc3lFeC5NaXhpbiA9IE1peGluO1xuRm9ybXN5RXguRm9ybSA9IEZvcm07XG5Gb3Jtc3lFeC5CbG9jayA9IEJsb2NrO1xuXG5pZiAoIWdsb2JhbC5leHBvcnRzICYmICFnbG9iYWwubW9kdWxlICYmICghZ2xvYmFsLmRlZmluZSB8fCAhZ2xvYmFsLmRlZmluZS5hbWQpKSB7XG4gIGdsb2JhbC5Gb3Jtc3lFeCA9IEZvcm1zeUV4O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZvcm1zeUV4O1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9saWIvbWFpbi5qc1xuICoqLyIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8xX187XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiBleHRlcm5hbCBcInJlYWN0XCJcbiAqKiBtb2R1bGUgaWQgPSAxXG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCJ2YXIgUmVhY3QgPSBnbG9iYWwuUmVhY3QgfHwgcmVxdWlyZSgncmVhY3QnKSxcbiAgICBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpLFxuICAgIHJlZ0Zvcm1zID0ge30sXG4gICAgbW9ja0Zvcm0gPSByZXF1aXJlKCcuL2Zvcm0nKSxcbiAgICBkZWZhdWx0Rm9ybSA9ICdfREVGQVVMVF9GT1JNJztcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgZm9jdXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gaWYgKCF0aGlzLnJlZnMuZm9jdXMpIHtcbiAgICAgICAgLy8gICAgdGhyb3cgbmV3IEVycm9yKCdzaG91bGQgaGF2ZSBhIGNoaWxkIGNvbXBvbmVudCB3aXRoIHJlZiBuYW1lIGBpbnB1dGAsIG1vc3Qgb2YgdGhlIGNhc2UgcmVmIGlzIHNldCBvbiBFcnJvck1zZ0xhYmVsJyk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgUmVhY3QuZmluZERPTU5vZGUodGhpcy5yZWZzLmZvY3VzKSAmJlxuICAgICAgICAgICAgUmVhY3QuZmluZERPTU5vZGUodGhpcy5yZWZzLmZvY3VzKS5mb2N1cygpO1xuICAgIH0sXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfZm9ybXN5RXhWYWx1ZTogJycsXG4gICAgICAgICAgICBfZm9ybXN5RXhFcnJvck1zZ3M6IFtdXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBjb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXM7XG4gICAgICAgIGlmIChjb21wb25lbnQuaXNJbml0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb21wb25lbnQuaXNGb3JtKSB7IC8vIGZvcm1cbiAgICAgICAgICAgIC8vIGZvcm0gb2JqZWN0XG4gICAgICAgICAgICB2YXIgZm9ybU5hbWUgPSBjb21wb25lbnQucHJvcHMubmFtZSA/IGNvbXBvbmVudC5wcm9wcy5uYW1lIDogZGVmYXVsdEZvcm07XG4gICAgICAgICAgICBpZiAocmVnRm9ybXNbZm9ybU5hbWVdKSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmlucHV0cyA9IHJlZ0Zvcm1zW2Zvcm1OYW1lXS5pbnB1dHM7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNoaWxkSWQgPSByZWdGb3Jtc1tmb3JtTmFtZV0uY2hpbGRJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZ0Zvcm1zW2Zvcm1OYW1lXSA9IGNvbXBvbmVudDtcbiAgICAgICAgICAgIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goXG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wcm9wcy5yZWdGb3JtICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnByb3BzLnJlZ0Zvcm0gIT09IGZvcm1OYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29tcG9uZW50cyBhcmUgcmVnaXN0ZXJlZCB0byBhbm90aGVyIGZvcm1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50LnJlZ2lzdGVyKGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQuaXNJbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgeyAvLyBlbGVtZW50cyBpbiBmb3JtXG4gICAgICAgICAgICB2YXIgcmVnVG9Gb3JtTmFtZTtcbiAgICAgICAgICAgIC8vIGlmICghdGhpcy52YWxpZGF0b3IgfHwgIXRoaXMudmFsaWRhdG9yLmNhbGwpIHtcbiAgICAgICAgICAgIC8vICAgIHRocm93IG5ldyBFcnJvcignc2hvdWxkIGltcGxlbWVudCBgZm9jdXNgIGFuZCBgdmFsaWRhdG9yYCBmdW5jdGlvbicpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgcmVnVG9Gb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5yZWdGb3JtID8gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gOiBkZWZhdWx0Rm9ybTtcbiAgICAgICAgICAgIGlmIChyZWdGb3Jtc1tyZWdUb0Zvcm1OYW1lXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0gPSBtb2NrRm9ybSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0ucmVnaXN0ZXIoY29tcG9uZW50KTtcbiAgICAgICAgfVxuICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gdHJ1ZTtcbiAgICB9LFxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb21wb25lbnQgPSB0aGlzO1xuICAgICAgICBpZiAoIWNvbXBvbmVudC5pc0luaXQpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbXBvbmVudC5pc0Zvcm0pIHsgLy8gZm9ybVxuICAgICAgICAgICAgLy8gZm9ybSBvYmplY3RcbiAgICAgICAgICAgIHZhciBmb3JtTmFtZSA9IGNvbXBvbmVudC5wcm9wcy5uYW1lID8gY29tcG9uZW50LnByb3BzLm5hbWUgOiBkZWZhdWx0Rm9ybTtcbiAgICAgICAgICAgIGRlbGV0ZSByZWdGb3Jtc1tmb3JtTmFtZV07XG4gICAgICAgICAgICBjb21wb25lbnQuaXNJbml0ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7IC8vIGVsZW1lbnRzIGluIGZvcm1cbiAgICAgICAgICAgIHZhciByZWdUb0Zvcm1OYW1lID0gY29tcG9uZW50LnByb3BzLnJlZ0Zvcm0gPyBjb21wb25lbnQucHJvcHMucmVnRm9ybSA6IGRlZmF1bHRGb3JtO1xuICAgICAgICAgICAgcmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0gPyAocmVnRm9ybXNbcmVnVG9Gb3JtTmFtZV0udW5yZWdpc3Rlcihjb21wb25lbnQpKSA6IHVuZGVmaW5lZCA7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdmFyIF92YWx1ZSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHRoaXMuc3RhdGUuX2Zvcm1WYWx1ZSxcbiAgICAgICAgICAgIHZhbGlkYXRvcnMgPSB0aGlzLmdldFZhbGlkYXRvcnMoKSxcbiAgICAgICAgICAgIGZvcm1zeUV4RXJyb3JNc2dzLFxuICAgICAgICAgICAgaXNDb250aW51ZSA9IHRydWUsXG4gICAgICAgICAgICByZXM7XG4gICAgICAgIHZhbGlkYXRvcnMgJiZcbiAgICAgICAgICAgIChmb3Jtc3lFeEVycm9yTXNncyA9IF8ubWFwKHZhbGlkYXRvcnMsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb250aW51ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXMgPSB2YWxpZGF0b3IoX3ZhbHVlKSB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5jb250aW51ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29udGludWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzLnJlcyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMubXNnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApKTtcbiAgICAgICAgZm9ybXN5RXhFcnJvck1zZ3MgPSBfLmZpbHRlcihcbiAgICAgICAgICAgIGZvcm1zeUV4RXJyb3JNc2dzLFxuICAgICAgICAgICAgZnVuY3Rpb24gKGZvcm1zeUV4RXJyb3JNc2cpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZSAmJiBmb3Jtc3lFeEVycm9yTXNnO1xuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgX2Zvcm1WYWx1ZTogX3ZhbHVlLFxuICAgICAgICAgICAgICAgIF9mb3Jtc3lFeEVycm9yTXNnczogZm9ybXN5RXhFcnJvck1zZ3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGZvcm1zeUV4RXJyb3JNc2dzLmxlbmd0aCA9PT0gMDtcbiAgICB9LFxuICAgIGdldFZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLl9mb3JtVmFsdWU7XG4gICAgfSxcbiAgICBnZXRFcnJvck1zZzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5fZm9ybXN5RXhFcnJvck1zZ3MubGVuZ3RoID09PSAxID9cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLl9mb3Jtc3lFeEVycm9yTXNnc1swXSA6IHRoaXMuc3RhdGUuX2Zvcm1zeUV4RXJyb3JNc2dzO1xuICAgIH0sXG4gICAgZ2V0VmFsaWRhdG9yczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcHJvcGVydHlWYWxpZGF0b3IgPSAgdGhpcy52YWxpZGF0b3JzICYmIHRoaXMudmFsaWRhdG9ycy5jYWxsID9cbiAgICAgICAgICAgIFt0aGlzLnZhbGlkYXRvcnNdIDpcbiAgICAgICAgICAgICh0aGlzLnZhbGlkYXRvcnMgfHwgW10pLFxuICAgICAgICAgICAgdmFsaWRhdG9ycyA9IHByb3BlcnR5VmFsaWRhdG9yLmNvbmNhdCh0aGlzLnByb3BzLnZhbGlkYXRvcnMgfHwgW10pO1xuICAgICAgICByZXR1cm4gdmFsaWRhdG9ycztcbiAgICB9XG59XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL2xpYi9NaXhpbi5qc1xuICoqLyIsInZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCByZXF1aXJlKCdyZWFjdCcpLFxuICAgIF8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpc0Zvcm06IHRydWUsXG4gICAgICAgIHJlZ2lzdGVyOiBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzID0gdGhpcy5pbnB1dHMgfHwge307XG4gICAgICAgICAgICB0aGlzLmNoaWxkSWQgPSB0aGlzLmNoaWxkSWQgfHwgMDtcbiAgICAgICAgICAgIGNoaWxkLnJlZ0lkID0gY2hpbGQucHJvcHMubmFtZSB8fCB0aGlzLmNoaWxkSWQrKztcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzW2NoaWxkLnJlZ0lkXSA9IGNoaWxkO1xuICAgICAgICB9LFxuICAgICAgICB1bnJlZ2lzdGVyOiBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmlucHV0c1tjaGlsZC5yZWdJZF07XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKSB8fCBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIGZpcnN0RXJyb3JDb21wb25lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dHMsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSBjb21wb25lbnQudmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0RXJyb3JDb21wb25lbnQgPSAoZmlyc3RFcnJvckNvbXBvbmVudCA9PT0gdW5kZWZpbmVkICYmIHJlcyA9PT0gZmFsc2UpID8gY29tcG9uZW50OiBmaXJzdEVycm9yQ29tcG9uZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGZpcnN0RXJyb3JDb21wb25lbnQgPT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vblN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDpcbiAgICAgICAgICAgICAgICBmaXJzdEVycm9yQ29tcG9uZW50LmZvY3VzICYmIGZpcnN0RXJyb3JDb21wb25lbnQuZm9jdXMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxmb3JtIG9uU3VibWl0PXt0aGlzLnN1Ym1pdH0gc3R5bGU9e3RoaXMucHJvcHMuc3R5bGV9IGNsYXNzTmFtZT17dGhpcy5wcm9wcy5jbGFzc05hbWV9PlxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfTtcbn07XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL2xpYi9mb3JtLmpzXG4gKiovIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzRfXztcblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIGV4dGVybmFsIFwidW5kZXJzY29yZVwiXG4gKiogbW9kdWxlIGlkID0gNFxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwiJ3VzZSBzdHJpY3QnO1xudmFyIFJlYWN0ID0gZ2xvYmFsLlJlYWN0IHx8IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiBcIm1vZHVsZS5leHBvcnRzXCIsXG4gICAgbWl4aW5zOiBbXG4gICAgICAgcmVxdWlyZSgnLi9NaXhpbicpXG4gICAgXSxcbiAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVycm9yTXNnID0gdGhpcy5nZXRFcnJvck1zZygpO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7c3R5bGU6IHRoaXMucHJvcHMuc3R5bGV9LCBcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmNoaWxkcmVuLCBcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIiwge3N0eWxlOiB7Y29sb3I6ICdyZWQnfX0sIGVycm9yTXNnLCBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwge3JlZjogXCJmb2N1c1wiLCBzdHlsZToge29wYWNpdHk6ICcwJ319KSlcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG59KTtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vbGliL0Jsb2NrLmpzeFxuICoqLyIsIid1c2Ugc3RyaWN0JztcbnZhciBSZWFjdCA9IGdsb2JhbC5SZWFjdCB8fCByZXF1aXJlKCdyZWFjdCcpLFxuICAgIGZvcm0gPSByZXF1aXJlKCcuL2Zvcm0nKSgpO1xuXG5mb3JtWydtaXhpbnMnXSA9IFtyZXF1aXJlKCcuL01peGluJyldO1xubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyhmb3JtKTtcblxuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9saWIvRm9ybS5qc3hcbiAqKi8iXSwic291cmNlUm9vdCI6IiJ9